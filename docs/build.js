!function(){"use strict";var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return(n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function r(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))}function i(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function o(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function a(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e}var u=!1,c="${JSCORE_VERSION}",l=function(e,t){if(!e)throw h(t)},h=function(e){return new Error("Firebase Database ("+c+") INTERNAL ASSERT FAILED: "+e)},d=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},p={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var o=e[i],s=i+1<e.length,a=s?e[i+1]:0,u=i+2<e.length,c=u?e[i+2]:0,l=o>>2,h=(3&o)<<4|a>>4,d=(15&a)<<2|c>>6,p=63&c;u||(p=64,s||(d=64)),r.push(n[l],n[h],n[d],n[p])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(d(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){var s=((7&i)<<18|(63&(o=e[n++]))<<12|(63&(a=e[n++]))<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{o=e[n++];var a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var o=n[e.charAt(i++)],s=i<e.length?n[e.charAt(i)]:0,a=++i<e.length?n[e.charAt(i)]:64,u=++i<e.length?n[e.charAt(i)]:64;if(++i,null==o||null==s||null==a||null==u)throw Error();var c=o<<2|s>>4;if(r.push(c),64!==a){var l=s<<4&240|a>>2;if(r.push(l),64!==u){var h=a<<6&192|u;r.push(h)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},f=function(e){try{return p.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function _(e){return y(void 0,e)}function y(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=y(e[n],t[n]));return e}var v=function(){function e(){var e=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(t,n){e.resolve=t,e.reject=n}))}return e.prototype.wrapCallback=function(e){var t=this;return function(n,r){n?t.reject(n):t.resolve(r),"function"==typeof e&&(t.promise.catch((function(){})),1===e.length?e(n):e(n,r))}},e}();function g(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")}function m(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function w(){return!0===u}var b=function(e){function n(t,r,i){var o=e.call(this,r)||this;return o.code=t,o.customData=i,o.name="FirebaseError",Object.setPrototypeOf(o,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(o,C.prototype.create),o}return t(n,e),n}(Error),C=function(){function e(e,t,n){this.service=e,this.serviceName=t,this.errors=n}return e.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=t[0]||{},i=this.service+"/"+e,o=this.errors[e],s=o?E(o,r):"Error",a=this.serviceName+": "+s+" ("+i+").",u=new b(i,a,r);return u},e}();function E(e,t){return e.replace(T,(function(e,n){var r=t[n];return null!=r?String(r):"<"+n+"?>"}))}var T=/\{\$([^}]+)}/g;function S(e){return JSON.parse(e)}function I(e){return JSON.stringify(e)}var k=function(e){var t={},n={},r={},i="";try{var o=e.split(".");t=S(f(o[0])||""),n=S(f(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}};function R(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function N(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function P(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function x(e,t,n){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}var A=function(){function e(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}return e.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},e.prototype.compress_=function(e,t){t||(t=0);var n=this.W_;if("string"==typeof e)for(var r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,s,a=this.chain_[0],u=this.chain_[1],c=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(r=0;r<80;r++){r<40?r<20?(o=l^u&(c^l),s=1518500249):(o=u^c^l,s=1859775393):r<60?(o=u&c|l&(u|c),s=2400959708):(o=u^c^l,s=3395469782);i=(a<<5|a>>>27)+o+h+s+n[r]&4294967295;h=l,l=c,c=4294967295&(u<<30|u>>>2),u=a,a=i}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+h&4294967295},e.prototype.update=function(e,t){if(null!=e){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<t;){if(0===o)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[o]=e.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<t;)if(i[o]=e[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}},e.prototype.digest=function(){var e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)e[r]=this.chain_[n]>>i&255,++r;return e},e}();function O(e,t){var n=new D(e,t);return n.subscribe.bind(n)}var D=function(){function e(e,t){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((function(){e(n)})).catch((function(e){n.error(e)}))}return e.prototype.next=function(e){this.forEachObserver((function(t){t.next(e)}))},e.prototype.error=function(e){this.forEachObserver((function(t){t.error(e)})),this.close(e)},e.prototype.complete=function(){this.forEachObserver((function(e){e.complete()})),this.close()},e.prototype.subscribe=function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e,t){if("object"!=typeof e||null===e)return!1;for(var n=0,r=t;n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return!0}return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n}).next&&(r.next=L),void 0===r.error&&(r.error=L),void 0===r.complete&&(r.complete=L);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(e){}})),this.observers.push(r),o},e.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},e.prototype.forEachObserver=function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)},e.prototype.sendOne=function(e,t){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))},e.prototype.close=function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((function(){t.observers=void 0,t.onNoObservers=void 0})))},e}();function L(){}var M=function(e,t,n,r){var i;if(r<t?i="at least "+t:r>n&&(i=0===n?"none":"no more than "+n),i)throw new Error(e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")};function F(e,t){return e+" failed: "+t+" argument "}function q(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(F(e,t)+"must be a valid function.")}function j(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(F(e,t)+"must be a valid context object.")}var W=function(e){for(var t=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function U(e){return e&&e._delegate?e._delegate:e}var B=function(){function e(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return e.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},e.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},e.prototype.setServiceProps=function(e){return this.serviceProps=e,this},e.prototype.setInstanceCreatedCallback=function(e){return this.onInstanceCreated=e,this},e}(),z="[DEFAULT]",H=function(){function e(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.onInitCallbacks=new Set}return e.prototype.get=function(e){void 0===e&&(e=z);var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){var n=new v;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:t});r&&n.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise},e.prototype.getImmediate=function(e){var t=n({identifier:z,optional:!1},e),r=t.identifier,i=t.optional,o=this.normalizeInstanceIdentifier(r);if(!this.isInitialized(o)&&!this.shouldAutoInitialize()){if(i)return null;throw Error("Service "+this.name+" is not available")}try{return this.getOrInitializeService({instanceIdentifier:o})}catch(e){if(i)return null;throw e}},e.prototype.getComponent=function(){return this.component},e.prototype.setComponent=function(e){var t,n;if(e.name!==this.name)throw Error("Mismatching Component "+e.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:z})}catch(e){}try{for(var r=o(this.instancesDeferred.entries()),i=r.next();!i.done;i=r.next()){var a=s(i.value,2),u=a[0],c=a[1],l=this.normalizeInstanceIdentifier(u);try{var h=this.getOrInitializeService({instanceIdentifier:l});c.resolve(h)}catch(e){}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}},e.prototype.clearInstance=function(e){void 0===e&&(e=z),this.instancesDeferred.delete(e),this.instances.delete(e)},e.prototype.delete=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return e=Array.from(this.instances.values()),[4,Promise.all(a(a([],s(e.filter((function(e){return"INTERNAL"in e})).map((function(e){return e.INTERNAL.delete()})))),s(e.filter((function(e){return"_delete"in e})).map((function(e){return e._delete()})))))];case 1:return t.sent(),[2]}}))}))},e.prototype.isComponentSet=function(){return null!=this.component},e.prototype.isInitialized=function(e){return void 0===e&&(e=z),this.instances.has(e)},e.prototype.initialize=function(e){var t,n;void 0===e&&(e={});var r=e.instanceIdentifier,i=void 0===r?z:r,a=e.options,u=void 0===a?{}:a,c=this.normalizeInstanceIdentifier(i);if(this.isInitialized(c))throw Error(this.name+"("+c+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var l=this.getOrInitializeService({instanceIdentifier:c,options:u});try{for(var h=o(this.instancesDeferred.entries()),d=h.next();!d.done;d=h.next()){var p=s(d.value,2),f=p[0],_=p[1];c===this.normalizeInstanceIdentifier(f)&&_.resolve(l)}}catch(e){t={error:e}}finally{try{d&&!d.done&&(n=h.return)&&n.call(h)}finally{if(t)throw t.error}}return this.invokeOnInitCallbacks(l,c),l},e.prototype.onInit=function(e){var t=this;return this.onInitCallbacks.add(e),function(){t.onInitCallbacks.delete(e)}},e.prototype.invokeOnInitCallbacks=function(e,t){var n,r;try{for(var i=o(this.onInitCallbacks),s=i.next();!s.done;s=i.next()){var a=s.value;try{a(e,t)}catch(e){}}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype.getOrInitializeService=function(e){var t,n=e.instanceIdentifier,r=e.options,i=void 0===r?{}:r,o=this.instances.get(n);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:(t=n,t===z?void 0:t),options:i}),this.instances.set(n,o),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,o)}catch(e){}return o||null},e.prototype.normalizeInstanceIdentifier=function(e){return this.component?this.component.multipleInstances?e:z:e},e.prototype.shouldAutoInitialize=function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode},e}();var V,Y=function(){function e(e){this.name=e,this.providers=new Map}return e.prototype.addComponent=function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component "+e.name+" has already been registered with "+this.name);t.setComponent(e)},e.prototype.addOrOverwriteComponent=function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)},e.prototype.getProvider=function(e){if(this.providers.has(e))return this.providers.get(e);var t=new H(e,this);return this.providers.set(e,t),t},e.prototype.getProviders=function(){return Array.from(this.providers.values())},e}();function Q(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}var K,G=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(K||(K={}));var $,J={debug:K.DEBUG,verbose:K.VERBOSE,info:K.INFO,warn:K.WARN,error:K.ERROR,silent:K.SILENT},X=K.INFO,Z=((V={})[K.DEBUG]="log",V[K.VERBOSE]="log",V[K.INFO]="info",V[K.WARN]="warn",V[K.ERROR]="error",V),ee=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(t<e.logLevel)){var i=(new Date).toISOString(),o=Z[t];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+t+")");console[o].apply(console,Q(["["+i+"]  "+e.name+":"],n))}},te=function(){function e(e){this.name=e,this._logLevel=X,this._logHandler=ee,this._userLogHandler=null,G.push(this)}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in K))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),e.prototype.setLogLevel=function(e){this._logLevel="string"==typeof e?J[e]:e},Object.defineProperty(e.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e},enumerable:!1,configurable:!0}),e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Q([this,K.DEBUG],e)),this._logHandler.apply(this,Q([this,K.DEBUG],e))},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Q([this,K.VERBOSE],e)),this._logHandler.apply(this,Q([this,K.VERBOSE],e))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Q([this,K.INFO],e)),this._logHandler.apply(this,Q([this,K.INFO],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Q([this,K.WARN],e)),this._logHandler.apply(this,Q([this,K.WARN],e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Q([this,K.ERROR],e)),this._logHandler.apply(this,Q([this,K.ERROR],e))},e}();function ne(e){G.forEach((function(t){t.setLogLevel(e)}))}var re,ie=(($={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",$["bad-app-name"]="Illegal App name: '{$appName}",$["duplicate-app"]="Firebase App named '{$appName}' already exists",$["app-deleted"]="Firebase App named '{$appName}' already deleted",$["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",$["invalid-log-argument"]="First argument to `onLog` must be null or a function.",$),oe=new C("app","Firebase",ie),se="@firebase/app",ae="[DEFAULT]",ue=((re={})[se]="fire-core",re["@firebase/analytics"]="fire-analytics",re["@firebase/app-check"]="fire-app-check",re["@firebase/auth"]="fire-auth",re["@firebase/database"]="fire-rtdb",re["@firebase/functions"]="fire-fn",re["@firebase/installations"]="fire-iid",re["@firebase/messaging"]="fire-fcm",re["@firebase/performance"]="fire-perf",re["@firebase/remote-config"]="fire-rc",re["@firebase/storage"]="fire-gcs",re["@firebase/firestore"]="fire-fst",re["fire-js"]="fire-js",re["firebase-wrapper"]="fire-js-all",re),ce=new te("@firebase/app"),le=function(){function e(e,t,n){var r=this;this.firebase_=n,this.isDeleted_=!1,this.name_=t.name,this.automaticDataCollectionEnabled_=t.automaticDataCollectionEnabled||!1,this.options_=_(e),this.container=new Y(t.name),this._addComponent(new B("app",(function(){return r}),"PUBLIC")),this.firebase_.INTERNAL.components.forEach((function(e){return r._addComponent(e)}))}return Object.defineProperty(e.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(e){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),e.prototype.delete=function(){var e=this;return new Promise((function(t){e.checkDestroyed_(),t()})).then((function(){return e.firebase_.INTERNAL.removeApp(e.name_),Promise.all(e.container.getProviders().map((function(e){return e.delete()})))})).then((function(){e.isDeleted_=!0}))},e.prototype._getService=function(e,t){var n;void 0===t&&(t=ae),this.checkDestroyed_();var r=this.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})},e.prototype._removeServiceInstance=function(e,t){void 0===t&&(t=ae),this.container.getProvider(e).clearInstance(t)},e.prototype._addComponent=function(e){try{this.container.addComponent(e)}catch(t){ce.debug("Component "+e.name+" failed to register with FirebaseApp "+this.name,t)}},e.prototype._addOrOverwriteComponent=function(e){this.container.addOrOverwriteComponent(e)},e.prototype.toJSON=function(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}},e.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw oe.create("app-deleted",{appName:this.name_})},e}();le.prototype.name&&le.prototype.options||le.prototype.delete||console.log("dc");function he(e){var t={},n=new Map,r={__esModule:!0,initializeApp:function(n,i){void 0===i&&(i={});if("object"!=typeof i||null===i){i={name:i}}var o=i;void 0===o.name&&(o.name=ae);var s=o.name;if("string"!=typeof s||!s)throw oe.create("bad-app-name",{appName:String(s)});if(R(t,s))throw oe.create("duplicate-app",{appName:s});var a=new e(n,o,r);return t[s]=a,a},app:i,registerVersion:function(e,t,n){var r,i=null!==(r=ue[e])&&void 0!==r?r:e;n&&(i+="-"+n);var s=i.match(/\s|\//),a=t.match(/\s|\//);if(s||a){var u=['Unable to register library "'+i+'" with version "'+t+'":'];return s&&u.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),s&&a&&u.push("and"),a&&u.push('version name "'+t+'" contains illegal characters (whitespace or "/")'),void ce.warn(u.join(" "))}o(new B(i+"-version",(function(){return{library:i,version:t}}),"VERSION"))},setLogLevel:ne,onLog:function(e,t){if(null!==e&&"function"!=typeof e)throw oe.create("invalid-log-argument");!function(e,t){for(var n=function(n){var r=null;t&&t.level&&(r=J[t.level]),n.userLogHandler=null===e?null:function(t,n){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];var s=i.map((function(e){if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}})).filter((function(e){return e})).join(" ");n>=(null!=r?r:t.logLevel)&&e({level:K[n].toLowerCase(),message:s,args:i,type:t.name})}},r=0,i=G;r<i.length;r++)n(i[r])}(e,t)},apps:null,SDK_VERSION:"8.6.1",INTERNAL:{registerComponent:o,removeApp:function(e){delete t[e]},components:n,useAsService:function(e,t){if("serverAuth"===t)return null;return t}}};function i(e){if(!R(t,e=e||ae))throw oe.create("no-app",{appName:e});return t[e]}function o(o){var s=o.name;if(n.has(s))return ce.debug("There were multiple attempts to register component "+s+"."),"PUBLIC"===o.type?r[s]:null;if(n.set(s,o),"PUBLIC"===o.type){var a=function(e){if(void 0===e&&(e=i()),"function"!=typeof e[s])throw oe.create("invalid-app-argument",{appName:s});return e[s]()};void 0!==o.serviceProps&&y(a,o.serviceProps),r[s]=a,e.prototype[s]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._getService.bind(this,s);return n.apply(this,o.multipleInstances?e:[])}}for(var u=0,c=Object.keys(t);u<c.length;u++){var l=c[u];t[l]._addComponent(o)}return"PUBLIC"===o.type?r[s]:null}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(t).map((function(e){return t[e]}))}}),i.App=e,r}var de=function e(){var t=he(le);return t.INTERNAL=n(n({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){y(t,e)},createSubscribe:O,ErrorFactory:C,deepExtend:y}),t}(),pe=function(){function e(e){this.container=e}return e.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(e){if(function(e){var t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){var t=e.getImmediate();return t.library+"/"+t.version}return null})).filter((function(e){return e})).join(" ")},e}();if("object"==typeof self&&self.self===self&&void 0!==self.firebase){ce.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var fe=self.firebase.SDK_VERSION;fe&&fe.indexOf("LITE")>=0&&ce.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var _e=de.initializeApp;de.initializeApp=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return m()&&ce.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the @rollup/plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/@rollup/plugin-node-resolve\n      '),_e.apply(void 0,e)};var ye=de;!function(e,t){e.INTERNAL.registerComponent(new B("platform-logger",(function(e){return new pe(e)}),"PRIVATE")),e.registerVersion(se,"0.6.22",t),e.registerVersion("fire-js","")}(ye);ye.registerVersion("firebase","8.6.1","app");var ve="";function ge(e){ve=e}var me,we=function(){function e(e){this.domStorage_=e,this.prefix_="firebase:"}return e.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),I(t))},e.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:S(t)},e.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},e.prototype.prefixedName_=function(e){return this.prefix_+e},e.prototype.toString=function(){return this.domStorage_.toString()},e}(),be=function(){function e(){this.cache_={},this.isInMemoryStorage=!0}return e.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},e.prototype.get=function(e){return R(this.cache_,e)?this.cache_[e]:null},e.prototype.remove=function(e){delete this.cache_[e]},e}(),Ce=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new we(t)}}catch(e){}return new be},Ee=Ce("localStorage"),Te=Ce("sessionStorage"),Se=new te("@firebase/database"),Ie=(me=1,function(){return me++}),ke=function(e){var t=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);if(i>=55296&&i<=56319){var o=i-55296;r++,l(r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t}(e),n=new A;n.update(t);var r=n.digest();return p.encodeByteArray(r)},Re=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n="",r=0;r<e.length;r++){var i=e[r];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?n+=Re.apply(null,i):n+="object"==typeof i?I(i):i,n+=" "}return n},Ne=null,Pe=!0,xe=function(e,t){l(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(Se.logLevel=K.VERBOSE,Ne=Se.log.bind(Se),t&&Te.set("logging_enabled",!0)):"function"==typeof e?Ne=e:(Ne=null,Te.remove("logging_enabled"))},Ae=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!0===Pe&&(Pe=!1,null===Ne&&!0===Te.get("logging_enabled")&&xe(!0)),Ne){var n=Re.apply(null,e);Ne(n)}},Oe=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];Ae.apply(void 0,a([e],s(t)))}},De=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE INTERNAL ERROR: "+Re.apply(void 0,a([],s(e)));Se.error(n)},Le=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE FATAL ERROR: "+Re.apply(void 0,a([],s(e)));throw Se.error(n),new Error(n)},Me=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE WARNING: "+Re.apply(void 0,a([],s(e)));Se.warn(n)},Fe=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},qe="[MIN_NAME]",je="[MAX_NAME]",We=function(e,t){if(e===t)return 0;if(e===qe||t===je)return-1;if(t===qe||e===je)return 1;var n=$e(e),r=$e(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1},Ue=function(e,t){return e===t?0:e<t?-1:1},Be=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+I(t))},ze=function(e){if("object"!=typeof e||null===e)return I(e);var t=[];for(var n in e)t.push(n);t.sort();for(var r="{",i=0;i<t.length;i++)0!==i&&(r+=","),r+=I(t[i]),r+=":",r+=ze(e[t[i]]);return r+="}"},He=function(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function Ve(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}var Ye=function(e){l(!Fe(e),"Invalid JSON number");var t,n,r,i,o,s=1023;0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),s))+s,r=Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,r=Math.round(e/Math.pow(2,-1074))));var a=[];for(o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(t?1:0),a.reverse();var u=a.join(""),c="";for(o=0;o<64;o+=8){var h=parseInt(u.substr(o,8),2).toString(16);1===h.length&&(h="0"+h),c+=h}return c.toLowerCase()};var Qe=new RegExp("^-?(0*)\\d{1,10}$"),Ke=-2147483648,Ge=2147483647,$e=function(e){if(Qe.test(e)){var t=Number(e);if(t>=Ke&&t<=Ge)return t}return null},Je=function(e){try{e()}catch(e){setTimeout((function(){var t=e.stack||"";throw Me("Exception was thrown by user callback.",t),e}),Math.floor(0))}},Xe=function(e,t){var n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n},Ze=function(){function e(e,t){var n=this;this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((function(e){return n.appCheck=e}))}return e.prototype.getToken=function(e){var t=this;return this.appCheck?this.appCheck.getToken(e):new Promise((function(n,r){setTimeout((function(){t.appCheck?t.getToken(e).then(n,r):n(null)}),0)}))},e.prototype.addTokenChangeListener=function(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((function(t){return t.addTokenListener(e)}))},e.prototype.notifyForInvalidToken=function(){Me('Provided AppCheck credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly.')},e}(),et=function(){function e(e,t,n){var r=this;this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((function(e){return r.auth_=e}))}return e.prototype.getToken=function(e){var t=this;return this.auth_?this.auth_.getToken(e).catch((function(e){return e&&"auth/token-not-initialized"===e.code?(Ae("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)})):new Promise((function(n,r){setTimeout((function(){t.auth_?t.getToken(e).then(n,r):n(null)}),0)}))},e.prototype.addTokenChangeListener=function(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((function(t){return t.addAuthTokenListener(e)}))},e.prototype.removeTokenChangeListener=function(e){this.authProvider_.get().then((function(t){return t.removeAuthTokenListener(e)}))},e.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Me(e)},e}(),tt=function(){function e(e){this.accessToken=e}return e.prototype.getToken=function(e){return Promise.resolve({accessToken:this.accessToken})},e.prototype.addTokenChangeListener=function(e){e(this.accessToken)},e.prototype.removeTokenChangeListener=function(e){},e.prototype.notifyForInvalidToken=function(){},e.OWNER="owner",e}(),nt=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,rt="websocket",it="long_polling",ot=function(){function e(e,t,n,r,i,o,s){void 0===i&&(i=!1),void 0===o&&(o=""),void 0===s&&(s=!1),this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=s,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ee.get("host:"+e)||this._host}return e.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},e.prototype.isCustomHost=function(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain},Object.defineProperty(e.prototype,"host",{get:function(){return this._host},set:function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ee.set("host:"+this._host,this.internalHost))},enumerable:!1,configurable:!0}),e.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},e.prototype.toURLString=function(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns="+this.namespace:"";return""+e+this.host+"/"+t},e}();function st(e,t,n){var r;if(l("string"==typeof t,"typeof type must == string"),l("object"==typeof n,"typeof params must == object"),t===rt)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==it)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);var i=[];return Ve(n,(function(e,t){i.push(e+"="+t)})),r+i.join("&")}var at=function(){function e(){this.counters_={}}return e.prototype.incrementCounter=function(e,t){void 0===t&&(t=1),R(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},e.prototype.get=function(){return _(this.counters_)},e}(),ut={},ct={};function lt(e){var t=e.toString();return ut[t]||(ut[t]=new at),ut[t]}var ht=function(){function e(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return e.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},e.prototype.handleResponse=function(e,t){var n=this;this.pendingResponses[e]=t;for(var r=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&Je((function(){n.onMessage_(e[t])}))},r=0;r<e.length;++r)t(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum];){if("break"===r())break}},e}(),dt="start",pt="close",ft=function(){function e(e,t,n,r,i,o,s){var a=this;this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=s,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Oe(e),this.stats_=lt(t),this.urlFn=function(e){return a.appCheckToken&&(e.ac=a.appCheckToken),st(t,it,e)}}return e.prototype.open=function(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new ht(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{var t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((function(){if(!n.isClosed_){n.scriptTagHolder=new _t((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=s(e,5),i=r[0],o=r[1],a=r[2];if(r[3],r[4],n.incrementIncomingBytes_(e),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,i===dt)n.id=o,n.password=a;else{if(i!==pt)throw new Error("Unrecognized command received: "+i);o?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(o,(function(){n.onClosed_()}))):n.onClosed_()}}),(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=s(e,2),i=r[0],o=r[1];n.incrementIncomingBytes_(e),n.myPacketOrderer.handleResponse(i,o)}),(function(){n.onClosed_()}),n.urlFn);var e={start:"t"};e.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=n.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",n.transportSessionId&&(e.s=n.transportSessionId),n.lastSessionId&&(e.ls=n.lastSessionId),n.applicationId&&(e.p=n.applicationId),n.appCheckToken&&(e.ac=n.appCheckToken),"undefined"!=typeof location&&location.hostname&&nt.test(location.hostname)&&(e.r="f");var t=n.urlFn(e);n.log_("Connecting via long-poll to "+t),n.scriptTagHolder.addTag(t,(function(){}))}}))},e.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},e.forceAllow=function(){e.forceAllow_=!0},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){return!!e.forceAllow_||!(e.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)},e.prototype.markConnectionHealthy=function(){},e.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},e.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},e.prototype.send=function(e){var t=I(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);for(var n,r=(n=d(t),p.encodeByteArray(n,!0)),i=He(r,1840),o=0;o<i.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[o]),this.curSegmentNum++},e.prototype.addDisconnectPingFrame=function(e,t){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)},e.prototype.incrementIncomingBytes_=function(e){var t=I(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)},e}(),_t=function(){function e(t,n,r,i){this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,this.uniqueCallbackIdentifier=Ie(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();var o="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(o='<script>document.domain="'+document.domain+'";<\/script>');var s="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(s),this.myIFrame.doc.close()}catch(e){Ae("frame writing exception"),e.stack&&Ae(e.stack),Ae(e)}}return e.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Ae("No IE domain setting required")}catch(n){var t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},e.prototype.close=function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)}),Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())},e.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},e.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;for(var t=this.urlFn(e),n="",r=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1},e.prototype.enqueueSegment=function(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()},e.prototype.addLongPollTag_=function(e,t){var n=this;this.outstandingRequests.add(t);var r=function(){n.outstandingRequests.delete(t),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(e,(function(){clearTimeout(i),r()}))},e.prototype.addTag=function(e,t){var n=this;setTimeout((function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){Ae("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(e){}}),Math.floor(1))},e}(),yt=null;"undefined"!=typeof MozWebSocket?yt=MozWebSocket:"undefined"!=typeof WebSocket&&(yt=WebSocket);var vt=function(){function e(t,n,r,i,o,s,a){this.connId=t,this.applicationId=r,this.appCheckToken=i,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Oe(this.connId),this.stats_=lt(n),this.connURL=e.connectionURL_(n,s,a,i),this.nodeAdmin=n.nodeAdmin}return e.connectionURL_=function(e,t,n,r){var i={v:"5"};return"undefined"!=typeof location&&location.hostname&&nt.test(location.hostname)&&(i.r="f"),t&&(i.s=t),n&&(i.ls=n),r&&(i.ac=r),st(e,rt,i)},e.prototype.open=function(e,t){var n=this;this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ee.set("previous_websocket_failure",!0);try{if(w());else{var r={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}};this.mySock=new yt(this.connURL,[],r)}}catch(e){this.log_("Error instantiating WebSocket.");var i=e.message||e.data;return i&&this.log_(i),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(e){n.handleIncomingFrame(e)},this.mySock.onerror=function(e){n.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&n.log_(t),n.onClosed_()}},e.prototype.start=function(){},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(t=!0)}return!t&&null!==yt&&!e.forceDisallow_},e.previouslyFailed=function(){return Ee.isInMemoryStorage||!0===Ee.get("previous_websocket_failure")},e.prototype.markConnectionHealthy=function(){Ee.remove("previous_websocket_failure")},e.prototype.appendFrame_=function(e){if(this.frames.push(e),this.frames.length===this.totalFrames){var t=this.frames.join("");this.frames=null;var n=S(t);this.onMessage(n)}},e.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},e.prototype.extractFrameCount_=function(e){if(l(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},e.prototype.handleIncomingFrame=function(e){if(null!==this.mySock){var t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var n=this.extractFrameCount_(t);null!==n&&this.appendFrame_(n)}}},e.prototype.send=function(e){this.resetKeepAlive();var t=I(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=He(t,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},e.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},e.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},e.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()}),Math.floor(45e3))},e.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},e.responsesRequiredToBeHealthy=2,e.healthyTimeout=3e4,e}(),gt=function(){function e(e){this.initTransports_(e)}return Object.defineProperty(e,"ALL_TRANSPORTS",{get:function(){return[ft,vt]},enumerable:!1,configurable:!0}),e.prototype.initTransports_=function(t){var n,r,i=vt&&vt.isAvailable(),s=i&&!vt.previouslyFailed();if(t.webSocketOnly&&(i||Me("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[vt];else{var a=this.transports_=[];try{for(var u=o(e.ALL_TRANSPORTS),c=u.next();!c.done;c=u.next()){var l=c.value;l&&l.isAvailable()&&a.push(l)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}},e.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},e.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},e}(),mt=function(){function e(e,t,n,r,i,o,s,a,u,c){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=s,this.onDisconnect_=a,this.onKill_=u,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Oe("c:"+this.id+":"),this.transportManager_=new gt(t),this.log_("Connection created"),this.start_()}return e.prototype.start_=function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){e.conn_&&e.conn_.open(n,r)}),Math.floor(0));var i=t.healthyTimeout||0;i>0&&(this.healthyTimeout_=Xe((function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>102400?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>10240?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))}),Math.floor(i)))},e.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},e.prototype.disconnReceiver_=function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},e.prototype.connReceiver_=function(e){var t=this;return function(n){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}},e.prototype.sendRequest=function(e){var t={t:"d",d:e};this.sendData_(t)},e.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},e.prototype.onSecondaryControl_=function(e){if("t"in e){var t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},e.prototype.onSecondaryMessageReceived_=function(e){var t=Be("t",e),n=Be("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}},e.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},e.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},e.prototype.onPrimaryMessageReceived_=function(e){var t=Be("t",e),n=Be("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)},e.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},e.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},e.prototype.onControl_=function(e){var t=Be("t",e);if("d"in e){var n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?De("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):De("Unknown control packet command: "+t)}},e.prototype.onHandshake_=function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&Me("Protocol version mismatch detected"),this.tryStartUpgrade_())},e.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},e.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Xe((function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())}),Math.floor(6e4))},e.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())},e.prototype.onConnectionEstablished_=function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Xe((function(){n.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))},e.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},e.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()},e.prototype.onConnectionLost_=function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ee.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},e.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},e.prototype.sendData_=function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)},e.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},e.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},e}(),wt=function(){function e(){}return e.prototype.put=function(e,t,n,r){},e.prototype.merge=function(e,t,n,r){},e.prototype.refreshAuthToken=function(e){},e.prototype.refreshAppCheckToken=function(e){},e.prototype.onDisconnectPut=function(e,t,n){},e.prototype.onDisconnectMerge=function(e,t,n){},e.prototype.onDisconnectCancel=function(e,t){},e.prototype.reportStats=function(e){},e}(),bt=function(){function e(e){this.allowedEvents_=e,this.listeners_={},l(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}return e.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Array.isArray(this.listeners_[e]))for(var r=a([],s(this.listeners_[e])),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)},e.prototype.on=function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)},e.prototype.off=function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)},e.prototype.validateEventType_=function(e){l(this.allowedEvents_.find((function(t){return t===e})),"Unknown event: "+e)},e}(),Ct=function(e){function n(){var t=e.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||g()||(window.addEventListener("online",(function(){t.online_||(t.online_=!0,t.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){t.online_&&(t.online_=!1,t.trigger("online",!1))}),!1)),t}return t(n,e),n.getInstance=function(){return new n},n.prototype.getInitialEvent=function(e){return l("online"===e,"Unknown event type: "+e),[this.online_]},n.prototype.currentlyOnline=function(){return this.online_},n}(bt),Et=function(){function e(e,t){if(void 0===t){this.pieces_=e.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}return e.prototype.toString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},e}();function Tt(){return new Et("")}function St(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function It(e){return e.pieces_.length-e.pieceNum_}function kt(e){var t=e.pieceNum_;return t<e.pieces_.length&&t++,new Et(e.pieces_,t)}function Rt(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function Nt(e,t){return void 0===t&&(t=0),e.pieces_.slice(e.pieceNum_+t)}function Pt(e){if(e.pieceNum_>=e.pieces_.length)return null;for(var t=[],n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new Et(t,0)}function xt(e,t){for(var n=[],r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof Et)for(r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{var i=t.split("/");for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new Et(n,0)}function At(e){return e.pieceNum_>=e.pieces_.length}function Ot(e,t){var n=St(e),r=St(t);if(null===n)return t;if(n===r)return Ot(kt(e),kt(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Dt(e,t){for(var n=Nt(e,0),r=Nt(t,0),i=0;i<n.length&&i<r.length;i++){var o=We(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1}function Lt(e,t){if(It(e)!==It(t))return!1;for(var n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function Mt(e,t){var n=e.pieceNum_,r=t.pieceNum_;if(It(e)>It(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}var Ft=function(e,t){this.errorPrefix_=t,this.parts_=Nt(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=W(this.parts_[n]);qt(this)};function qt(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+jt(e))}function jt(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}var Wt,Ut,Bt=function(e){function n(){var t,n,r=e.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",t="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",t="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,(function(){var e=!document[t];e!==r.visible_&&(r.visible_=e,r.trigger("visible",e))}),!1),r}return t(n,e),n.getInstance=function(){return new n},n.prototype.getInitialEvent=function(e){return l("visible"===e,"Unknown event type: "+e),[this.visible_]},n}(bt),zt=1e3,Ht=function(e){function n(t,r,i,o,s,a,u,c){var l=e.call(this)||this;if(l.repoInfo_=t,l.applicationId_=r,l.onDataUpdate_=i,l.onConnectStatus_=o,l.onServerInfoUpdate_=s,l.authTokenProvider_=a,l.appCheckTokenProvider_=u,l.authOverride_=c,l.id=n.nextPersistentConnectionId_++,l.log_=Oe("p:"+l.id+":"),l.interruptReasons_={},l.listens=new Map,l.outstandingPuts_=[],l.outstandingGets_=[],l.outstandingPutCount_=0,l.outstandingGetCount_=0,l.onDisconnectRequestQueue_=[],l.connected_=!1,l.reconnectDelay_=zt,l.maxReconnectDelay_=3e5,l.securityDebugCallback_=null,l.lastSessionId=null,l.establishConnectionTimer_=null,l.visible_=!1,l.requestCBHash_={},l.requestNumber_=0,l.realtime_=null,l.authToken_=null,l.appCheckToken_=null,l.forceTokenRefresh_=!1,l.invalidAuthTokenCount_=0,l.invalidAppCheckTokenCount_=0,l.firstConnection_=!0,l.lastConnectionAttemptTime_=null,l.lastConnectionEstablishedTime_=null,c&&!w())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return Bt.getInstance().on("visible",l.onVisible_,l),-1===t.host.indexOf("fblocal")&&Ct.getInstance().on("online",l.onOnline_,l),l}return t(n,e),n.prototype.sendRequest=function(e,t,n){var r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(I(i)),l(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},n.prototype.get=function(e){var t=this;this.initConnection_();var n=new v,r={p:e._path.toString(),q:e._queryObject},i={action:"g",request:r,onComplete:function(e){var i=e.d;"ok"===e.s?(t.onDataUpdate_(r.p,i,!1,null),n.resolve(i)):n.reject(i)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;var o=this.outstandingGets_.length-1;return this.connected_||setTimeout((function(){var e=t.outstandingGets_[o];void 0!==e&&i===e&&(delete t.outstandingGets_[o],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),t.log_("get "+o+" timed out on connection"),n.reject(new Error("Client is offline.")))}),3e3),this.connected_&&this.sendGet_(o),n.promise},n.prototype.listen=function(e,t,n,r){this.initConnection_();var i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),l(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),l(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var s={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(o).set(i,s),this.connected_&&this.sendListen_(s)},n.prototype.sendGet_=function(e){var t=this,n=this.outstandingGets_[e];this.sendRequest("g",n.request,(function(r){delete t.outstandingGets_[e],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),n.onComplete&&n.onComplete(r)}))},n.prototype.sendListen_=function(e){var t=this,r=e.query,i=r._path.toString(),o=r._queryIdentifier;this.log_("Listen on "+i+" for "+o);var s={p:i};e.tag&&(s.q=r._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest("q",s,(function(s){var a=s.d,u=s.s;n.warnOnListenWarnings_(a,r),(t.listens.get(i)&&t.listens.get(i).get(o))===e&&(t.log_("listen response",s),"ok"!==u&&t.removeListen_(i,o),e.onComplete&&e.onComplete(u,a))}))},n.warnOnListenWarnings_=function(e,t){if(e&&"object"==typeof e&&R(e,"w")){var n=N(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();Me("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},n.prototype.refreshAuthToken=function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(e)},n.prototype.reduceReconnectDelayIfAdminCredential_=function(e){var t;(e&&40===e.length||"object"==typeof(t=k(e).claims)&&!0===t.admin)&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},n.prototype.refreshAppCheckToken=function(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(function(){}))},n.prototype.tryAuth=function(){var e,t=this;if(this.connected_&&this.authToken_){var n=this.authToken_,r=(e=k(n).claims)&&"object"==typeof e&&e.hasOwnProperty("iat")?"auth":"gauth",i={cred:n};null===this.authOverride_?i.noauth=!0:"object"==typeof this.authOverride_&&(i.authvar=this.authOverride_),this.sendRequest(r,i,(function(e){var r=e.s,i=e.d||"error";t.authToken_===n&&("ok"===r?t.invalidAuthTokenCount_=0:t.onAuthRevoked_(r,i))}))}},n.prototype.tryAppCheck=function(){var e=this;this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(function(t){var n=t.s,r=t.d||"error";"ok"===n?e.invalidAppCheckTokenCount_=0:e.onAppCheckRevoked_(n,r)}))},n.prototype.unlisten=function(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),l(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)},n.prototype.sendUnlisten_=function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);var i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},n.prototype.onDisconnectPut=function(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})},n.prototype.onDisconnectMerge=function(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})},n.prototype.onDisconnectCancel=function(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},n.prototype.sendOnDisconnect_=function(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,(function(e){r&&setTimeout((function(){r(e.s,e.d)}),Math.floor(0))}))},n.prototype.put=function(e,t,n,r){this.putInternal("p",e,t,n,r)},n.prototype.merge=function(e,t,n,r){this.putInternal("m",e,t,n,r)},n.prototype.putInternal=function(e,t,n,r,i){this.initConnection_();var o={p:t,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;var s=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(s):this.log_("Buffering put: "+t)},n.prototype.sendPut_=function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,(function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),i&&i(r.s,r.d)}))},n.prototype.reportStats=function(e){var t=this;if(this.connected_){var n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,(function(e){if("ok"!==e.s){var n=e.d;t.log_("reportStats","Error sending stats: "+n)}}))}},n.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+I(e));var t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}},n.prototype.onDataPush_=function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):De("Unrecognized action received from server: "+I(e)+"\nAre you using the latest client?")},n.prototype.onReady_=function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},n.prototype.scheduleConnect_=function(e){var t=this;l(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){t.establishConnectionTimer_=null,t.establishConnection_()}),Math.floor(e))},n.prototype.initConnection_=function(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)},n.prototype.onVisible_=function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=zt,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},n.prototype.onOnline_=function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=zt,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},n.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=zt),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var e=(new Date).getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},n.prototype.establishConnection_=function(){return r(this,void 0,void 0,(function(){var e,t,r,o,a,u,c,h,d,p,f,_,y,v,g=this;return i(this,(function(i){switch(i.label){case 0:if(!this.shouldReconnect_())return[3,4];this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null,e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),o=this.id+":"+n.nextConnectionId_++,a=this.lastSessionId,u=!1,c=null,h=function(){c?c.close():(u=!0,r())},d=function(e){l(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(e)},this.realtime_={close:h,sendRequest:d},p=this.forceTokenRefresh_,this.forceTokenRefresh_=!1,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Promise.all([this.authTokenProvider_.getToken(p),this.appCheckTokenProvider_.getToken(p)])];case 2:return f=s.apply(void 0,[i.sent(),2]),_=f[0],y=f[1],u?Ae("getToken() completed but was canceled"):(Ae("getToken() completed. Creating connection."),this.authToken_=_&&_.accessToken,this.appCheckToken_=y&&y.token,c=new mt(o,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,(function(e){Me(e+" ("+g.repoInfo_.toString()+")"),g.interrupt("server_kill")}),a)),[3,4];case 3:return v=i.sent(),this.log_("Failed to get token: "+v),u||(this.repoInfo_.nodeAdmin&&Me(v),h()),[3,4];case 4:return[2]}}))}))},n.prototype.interrupt=function(e){Ae("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},n.prototype.resume=function(e){Ae("Resuming connection for reason: "+e),delete this.interruptReasons_[e],P(this.interruptReasons_)&&(this.reconnectDelay_=zt,this.realtime_||this.scheduleConnect_(0))},n.prototype.handleTimestamp_=function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})},n.prototype.cancelSentTransactions_=function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},n.prototype.onListenRevoked_=function(e,t){var n;n=t?t.map((function(e){return ze(e)})).join("$"):"default";var r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")},n.prototype.removeListen_=function(e,t){var n,r=new Et(e).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(t),i.delete(t),0===i.size&&this.listens.delete(r)}else n=void 0;return n},n.prototype.onAuthRevoked_=function(e,t){Ae("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},n.prototype.onAppCheckRevoked_=function(e,t){Ae("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())},n.prototype.onSecurityDebugPacket_=function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))},n.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth(),this.tryAppCheck();try{for(var i=o(this.listens.values()),s=i.next();!s.done;s=i.next()){var a=s.value;try{for(var u=(n=void 0,o(a.values())),c=u.next();!c.done;c=u.next()){var l=c.value;this.sendListen_(l)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}for(var h=0;h<this.outstandingPuts_.length;h++)this.outstandingPuts_[h]&&this.sendPut_(h);for(;this.onDisconnectRequestQueue_.length;){var d=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(d.action,d.pathString,d.data,d.onComplete)}for(h=0;h<this.outstandingGets_.length;h++)this.outstandingGets_[h]&&this.sendGet_(h)},n.prototype.sendConnectStats_=function(){var e={};e["sdk.js."+ve.replace(/\./g,"-")]=1,g()?e["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(e["framework.reactnative"]=1),this.reportStats(e)},n.prototype.shouldReconnect_=function(){var e=Ct.getInstance().currentlyOnline();return P(this.interruptReasons_)&&e},n.nextPersistentConnectionId_=0,n.nextConnectionId_=0,n}(wt),Vt=function(){function e(e,t){this.name=e,this.node=t}return e.Wrap=function(t,n){return new e(t,n)},e}(),Yt=function(){function e(){}return e.prototype.getCompare=function(){return this.compare.bind(this)},e.prototype.indexedValueChanged=function(e,t){var n=new Vt(qe,e),r=new Vt(qe,t);return 0!==this.compare(n,r)},e.prototype.minPost=function(){return Vt.MIN},e}(),Qt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),Object.defineProperty(n,"__EMPTY_NODE",{get:function(){return Wt},set:function(e){Wt=e},enumerable:!1,configurable:!0}),n.prototype.compare=function(e,t){return We(e.name,t.name)},n.prototype.isDefinedOn=function(e){throw h("KeyIndex.isDefinedOn not expected to be called.")},n.prototype.indexedValueChanged=function(e,t){return!1},n.prototype.minPost=function(){return Vt.MIN},n.prototype.maxPost=function(){return new Vt(je,Wt)},n.prototype.makePost=function(e,t){return l("string"==typeof e,"KeyIndex indexValue must always be a string."),new Vt(e,Wt)},n.prototype.toString=function(){return".key"},n}(Yt),Kt=new Qt,Gt=function(){function e(e,t,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!e.isEmpty();)if(e=e,o=t?n(e.key,t):1,r&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}return e.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e},e.prototype.hasNext=function(){return this.nodeStack_.length>0},e.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},e}(),$t=function(){function e(t,n,r,i,o){this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:Xt.EMPTY_NODE,this.right=null!=o?o:Xt.EMPTY_NODE}return e.prototype.copy=function(t,n,r,i,o){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},e.prototype.count=function(){return this.left.count()+1+this.right.count()},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},e.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},e.prototype.minKey=function(){return this.min_().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()},e.prototype.removeMin_=function(){if(this.left.isEmpty())return Xt.EMPTY_NODE;var e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()},e.prototype.remove=function(e,t){var n,r;if(t(e,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Xt.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()},e.prototype.isRed_=function(){return this.color},e.prototype.fixUp_=function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},e.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e},e.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e},e.prototype.rotateLeft_=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight_=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},e.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1},e.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)},e.RED=!0,e.BLACK=!1,e}(),Jt=function(){function e(){}return e.prototype.copy=function(e,t,n,r,i){return this},e.prototype.insert=function(e,t,n){return new $t(e,t,null)},e.prototype.remove=function(e,t){return this},e.prototype.count=function(){return 0},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(e){return!1},e.prototype.reverseTraversal=function(e){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.check_=function(){return 0},e.prototype.isRed_=function(){return!1},e}(),Xt=function(){function e(t,n){void 0===n&&(n=e.EMPTY_NODE),this.comparator_=t,this.root_=n}return e.prototype.insert=function(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,$t.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,$t.BLACK,null,null))},e.prototype.get=function(e){for(var t,n=this.root_;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null},e.prototype.getPredecessorKey=function(e){for(var t,n=this.root_,r=null;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},e.prototype.isEmpty=function(){return this.root_.isEmpty()},e.prototype.count=function(){return this.root_.count()},e.prototype.minKey=function(){return this.root_.minKey()},e.prototype.maxKey=function(){return this.root_.maxKey()},e.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},e.prototype.getIterator=function(e){return new Gt(this.root_,null,this.comparator_,!1,e)},e.prototype.getIteratorFrom=function(e,t){return new Gt(this.root_,e,this.comparator_,!1,t)},e.prototype.getReverseIteratorFrom=function(e,t){return new Gt(this.root_,e,this.comparator_,!0,t)},e.prototype.getReverseIterator=function(e){return new Gt(this.root_,null,this.comparator_,!0,e)},e.EMPTY_NODE=new Jt,e}();function Zt(e,t){return We(e.name,t.name)}function en(e,t){return We(e,t)}var tn,nn,rn,on=function(e){return"number"==typeof e?"number:"+Ye(e):"string:"+e},sn=function(e){if(e.isLeafNode()){var t=e.val();l("string"==typeof t||"number"==typeof t||"object"==typeof t&&R(t,".sv"),"Priority must be a string or number.")}else l(e===Ut||e.isEmpty(),"priority of unexpected type.");l(e===Ut||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},an=function(){function e(t,n){void 0===n&&(n=e.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=n,this.lazyHash_=null,l(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),sn(this.priorityNode_)}return Object.defineProperty(e,"__childrenNodeConstructor",{get:function(){return tn},set:function(e){tn=e},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!0},e.prototype.getPriority=function(){return this.priorityNode_},e.prototype.updatePriority=function(t){return new e(this.value_,t)},e.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.getChild=function(t){return At(t)?this:".priority"===St(t)?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.hasChild=function(){return!1},e.prototype.getPredecessorChildName=function(e,t){return null},e.prototype.updateImmediateChild=function(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)},e.prototype.updateChild=function(t,n){var r=St(t);return null===r?n:n.isEmpty()&&".priority"!==r?this:(l(".priority"!==r||1===It(t),".priority must be the last token in a path"),this.updateImmediateChild(r,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(kt(t),n)))},e.prototype.isEmpty=function(){return!1},e.prototype.numChildren=function(){return 0},e.prototype.forEachChild=function(e,t){return!1},e.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+on(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"===t?Ye(this.value_):this.value_,this.lazyHash_=ke(e)}return this.lazyHash_},e.prototype.getValue=function(){return this.value_},e.prototype.compareTo=function(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:(l(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},e.prototype.compareToLeafNode_=function(t){var n=typeof t.value_,r=typeof this.value_,i=e.VALUE_TYPE_ORDER.indexOf(n),o=e.VALUE_TYPE_ORDER.indexOf(r);return l(i>=0,"Unknown leaf type: "+n),l(o>=0,"Unknown leaf type: "+r),i===o?"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-i},e.prototype.withIndex=function(){return this},e.prototype.isIndexed=function(){return!0},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode()){var t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1},e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e}();var un,cn,ln=new(function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.compare=function(e,t){var n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?We(e.name,t.name):i},n.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},n.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},n.prototype.minPost=function(){return Vt.MIN},n.prototype.maxPost=function(){return new Vt(je,new an("[PRIORITY-POST]",rn))},n.prototype.makePost=function(e,t){var n=nn(e);return new Vt(t,new an("[PRIORITY-POST]",n))},n.prototype.toString=function(){return".priority"},n}(Yt)),hn=Math.log(2),dn=function(){function e(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/hn,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}return e.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},e}(),pn=function(e,t,n,r){e.sort(t);var i=function(t,r){var o,s,a=r-t;if(0===a)return null;if(1===a)return o=e[t],s=n?n(o):o,new $t(s,o.node,$t.BLACK,null,null);var u=parseInt(a/2,10)+t,c=i(t,u),l=i(u+1,r);return o=e[u],s=n?n(o):o,new $t(s,o.node,$t.BLACK,c,l)},o=function(t){for(var r=null,o=null,s=e.length,a=function(t,r){var o=s-t,a=s;s-=t;var c=i(o+1,a),l=e[o],h=n?n(l):l;u(new $t(h,l.node,r,null,c))},u=function(e){r?(r.left=e,r=e):(o=e,r=e)},c=0;c<t.count;++c){var l=t.nextBitIsOne(),h=Math.pow(2,t.count-(c+1));l?a(h,$t.BLACK):(a(h,$t.BLACK),a(h,$t.RED))}return o}(new dn(e.length));return new Xt(r||t,o)},fn={},_n=function(){function e(e,t){this.indexes_=e,this.indexSet_=t}return Object.defineProperty(e,"Default",{get:function(){return l(fn&&ln,"ChildrenNode.ts has not been loaded"),un=un||new e({".priority":fn},{".priority":ln})},enumerable:!1,configurable:!0}),e.prototype.get=function(e){var t=N(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Xt?t:null},e.prototype.hasIndex=function(e){return R(this.indexSet_,e.toString())},e.prototype.addIndex=function(t,r){l(t!==Kt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var i,o=[],s=!1,a=r.getIterator(Vt.Wrap),u=a.getNext();u;)s=s||t.isDefinedOn(u.node),o.push(u),u=a.getNext();i=s?pn(o,t.getCompare()):fn;var c=t.toString(),h=n({},this.indexSet_);h[c]=t;var d=n({},this.indexes_);return d[c]=i,new e(d,h)},e.prototype.addToIndexes=function(t,n){var r=this;return new e(x(this.indexes_,(function(e,i){var o=N(r.indexSet_,i);if(l(o,"Missing index implementation for "+i),e===fn){if(o.isDefinedOn(t.node)){for(var s=[],a=n.getIterator(Vt.Wrap),u=a.getNext();u;)u.name!==t.name&&s.push(u),u=a.getNext();return s.push(t),pn(s,o.getCompare())}return fn}var c=n.get(t.name),h=e;return c&&(h=h.remove(new Vt(t.name,c))),h.insert(t,t.node)})),this.indexSet_)},e.prototype.removeFromIndexes=function(t,n){return new e(x(this.indexes_,(function(e){if(e===fn)return e;var r=n.get(t.name);return r?e.remove(new Vt(t.name,r)):e})),this.indexSet_)},e}(),yn=function(){function e(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&sn(this.priorityNode_),this.children_.isEmpty()&&l(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(e,"EMPTY_NODE",{get:function(){return cn||(cn=new e(new Xt(en),null,_n.Default))},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!1},e.prototype.getPriority=function(){return this.priorityNode_||cn},e.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)},e.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?cn:t},e.prototype.getChild=function(e){var t=St(e);return null===t?this:this.getImmediateChild(t).getChild(kt(e))},e.prototype.hasChild=function(e){return null!==this.children_.get(e)},e.prototype.updateImmediateChild=function(t,n){if(l(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);var r=new Vt(t,n),i=void 0,o=void 0;n.isEmpty()?(i=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,n),o=this.indexMap_.addToIndexes(r,this.children_));var s=i.isEmpty()?cn:this.priorityNode_;return new e(i,s,o)},e.prototype.updateChild=function(e,t){var n=St(e);if(null===n)return t;l(".priority"!==St(e)||1===It(e),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(kt(e),t);return this.updateImmediateChild(n,r)},e.prototype.isEmpty=function(){return this.children_.isEmpty()},e.prototype.numChildren=function(){return this.children_.count()},e.prototype.val=function(t){if(this.isEmpty())return null;var n={},r=0,i=0,o=!0;if(this.forEachChild(ln,(function(s,a){n[s]=a.val(t),r++,o&&e.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):o=!1})),!t&&o&&i<2*r){var s=[];for(var a in n)s[a]=n[a];return s}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+on(this.getPriority().val())+":"),this.forEachChild(ln,(function(t,n){var r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":ke(e)}return this.lazyHash_},e.prototype.getPredecessorChildName=function(e,t,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new Vt(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)},e.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()},e.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new Vt(t,this.children_.get(t)):null},e.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()},e.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new Vt(t,this.children_.get(t)):null},e.prototype.forEachChild=function(e,t){var n=this.resolveIndex_(e);return n?n.inorderTraversal((function(e){return t(e.name,e.node)})):this.children_.inorderTraversal(t)},e.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},e.prototype.getIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getIteratorFrom(e.name,Vt.Wrap),i=r.peek();null!=i&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r},e.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},e.prototype.getReverseIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getReverseIteratorFrom(e.name,Vt.Wrap),i=r.peek();null!=i&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r},e.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===vn?-1:0},e.prototype.withIndex=function(t){if(t===Kt||this.indexMap_.hasIndex(t))return this;var n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)},e.prototype.isIndexed=function(e){return e===Kt||this.indexMap_.hasIndex(e)},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){for(var n=this.getIterator(ln),r=t.getIterator(ln),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1}return!1},e.prototype.resolveIndex_=function(e){return e===Kt?null:this.indexMap_.get(e.toString())},e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e}(),vn=new(function(e){function n(){return e.call(this,new Xt(en),yn.EMPTY_NODE,_n.Default)||this}return t(n,e),n.prototype.compareTo=function(e){return e===this?0:1},n.prototype.equals=function(e){return e===this},n.prototype.getPriority=function(){return this},n.prototype.getImmediateChild=function(e){return yn.EMPTY_NODE},n.prototype.isEmpty=function(){return!1},n}(yn));Object.defineProperties(Vt,{MIN:{value:new Vt(qe,yn.EMPTY_NODE)},MAX:{value:new Vt(je,vn)}}),Qt.__EMPTY_NODE=yn.EMPTY_NODE,an.__childrenNodeConstructor=yn,Ut=vn,function(e){rn=e}(vn);function gn(e,t){if(void 0===t&&(t=null),null===e)return yn.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),l(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new an(e,gn(t));if(e instanceof Array){var n=yn.EMPTY_NODE;return Ve(e,(function(t,r){if(R(e,t)&&"."!==t.substring(0,1)){var i=gn(r);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(t,i))}})),n.updatePriority(gn(t))}var r=[],i=!1;if(Ve(e,(function(e,t){if("."!==e.substring(0,1)){var n=gn(t);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),r.push(new Vt(e,n)))}})),0===r.length)return yn.EMPTY_NODE;var o=pn(r,Zt,(function(e){return e.name}),en);if(i){var s=pn(r,ln.getCompare());return new yn(o,gn(t),new _n({".priority":s},{".priority":ln}))}return new yn(o,gn(t),_n.Default)}!function(e){nn=e}(gn);var mn,wn,bn=function(e){function n(t){var n=e.call(this)||this;return n.indexPath_=t,l(!At(t)&&".priority"!==St(t),"Can't create PathIndex with empty path or .priority key"),n}return t(n,e),n.prototype.extractChild=function(e){return e.getChild(this.indexPath_)},n.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()},n.prototype.compare=function(e,t){var n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?We(e.name,t.name):i},n.prototype.makePost=function(e,t){var n=gn(e),r=yn.EMPTY_NODE.updateChild(this.indexPath_,n);return new Vt(t,r)},n.prototype.maxPost=function(){var e=yn.EMPTY_NODE.updateChild(this.indexPath_,vn);return new Vt(je,e)},n.prototype.toString=function(){return Nt(this.indexPath_,0).join("/")},n}(Yt),Cn=new(function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.compare=function(e,t){var n=e.node.compareTo(t.node);return 0===n?We(e.name,t.name):n},n.prototype.isDefinedOn=function(e){return!0},n.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},n.prototype.minPost=function(){return Vt.MIN},n.prototype.maxPost=function(){return Vt.MAX},n.prototype.makePost=function(e,t){var n=gn(e);return new Vt(t,n)},n.prototype.toString=function(){return".value"},n}(Yt)),En="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Tn=(mn=0,wn=[],function(e){var t,n=e===mn;mn=e;var r=new Array(8);for(t=7;t>=0;t--)r[t]=En.charAt(e%64),e=Math.floor(e/64);l(0===e,"Cannot push at time == 0");var i=r.join("");if(n){for(t=11;t>=0&&63===wn[t];t--)wn[t]=0;wn[t]++}else for(t=0;t<12;t++)wn[t]=Math.floor(64*Math.random());for(t=0;t<12;t++)i+=En.charAt(wn[t]);return l(20===i.length,"nextPushId: Length should be 20."),i}),Sn=function(e){if("2147483647"===e)return"-";var t=$e(e);if(null!=t)return""+(t+1);for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e.charAt(r);if(n.length<786)return n.push("-"),n.join("");for(var i=n.length-1;i>=0&&"z"===n[i];)i--;if(-1===i)return je;var o=n[i],s=En.charAt(En.indexOf(o)+1);return n[i]=s,n.slice(0,i+1).join("")},In=function(e){if("-2147483648"===e)return qe;var t=$e(e);if(null!=t)return""+(t-1);for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e.charAt(r);return"-"===n[n.length-1]?1===n.length?"2147483647":(delete n[n.length-1],n.join("")):(n[n.length-1]=En.charAt(En.indexOf(n[n.length-1])-1),n.join("")+"z".repeat(786-n.length))};function kn(e){return{type:"value",snapshotNode:e}}function Rn(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Nn(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Pn(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}var xn=function(){function e(e){this.index_=e}return e.prototype.updateChild=function(e,t,n,r,i,o){l(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var s=e.getImmediateChild(t);return s.getChild(r).equals(n.getChild(r))&&s.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(Nn(t,s)):l(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):s.isEmpty()?o.trackChildChange(Rn(t,n)):o.trackChildChange(Pn(t,n,s))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))},e.prototype.updateFullNode=function(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(ln,(function(e,r){t.hasChild(e)||n.trackChildChange(Nn(e,r))})),t.isLeafNode()||t.forEachChild(ln,(function(t,r){if(e.hasChild(t)){var i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(Pn(t,r,i))}else n.trackChildChange(Rn(t,r))}))),t.withIndex(this.index_)},e.prototype.updatePriority=function(e,t){return e.isEmpty()?yn.EMPTY_NODE:e.updatePriority(t)},e.prototype.filtersNodes=function(){return!1},e.prototype.getIndexedFilter=function(){return this},e.prototype.getIndex=function(){return this.index_},e}(),An=function(){function e(t){this.indexedFilter_=new xn(t.getIndex()),this.index_=t.getIndex(),this.startPost_=e.getStartPost_(t),this.endPost_=e.getEndPost_(t)}return e.prototype.getStartPost=function(){return this.startPost_},e.prototype.getEndPost=function(){return this.endPost_},e.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},e.prototype.updateChild=function(e,t,n,r,i,o){return this.matches(new Vt(t,n))||(n=yn.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,o)},e.prototype.updateFullNode=function(e,t,n){t.isLeafNode()&&(t=yn.EMPTY_NODE);var r=t.withIndex(this.index_);r=r.updatePriority(yn.EMPTY_NODE);var i=this;return t.forEachChild(ln,(function(e,t){i.matches(new Vt(e,t))||(r=r.updateImmediateChild(e,yn.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.indexedFilter_},e.prototype.getIndex=function(){return this.index_},e.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()},e.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()},e}(),On=function(){function e(e){this.rangedFilter_=new An(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}return e.prototype.updateChild=function(e,t,n,r,i,o){return this.rangedFilter_.matches(new Vt(t,n))||(n=yn.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,o):this.fullLimitUpdateChild_(e,t,n,i,o)},e.prototype.updateFullNode=function(e,t,n){var r;if(t.isLeafNode()||t.isEmpty())r=yn.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){r=yn.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var s=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),s)<=0:this.index_.compare(s,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(s.name,s.node),o++}}else{r=(r=t.withIndex(this.index_)).updatePriority(yn.EMPTY_NODE);var a=void 0,u=void 0,c=void 0;i=void 0;if(this.reverse_){i=r.getReverseIterator(this.index_),a=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var l=this.index_.getCompare();c=function(e,t){return l(t,e)}}else i=r.getIterator(this.index_),a=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var h=!1;i.hasNext();){s=i.getNext();!h&&c(a,s)<=0&&(h=!0),h&&o<this.limit_&&c(s,u)<=0?o++:r=r.updateImmediateChild(s.name,yn.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},e.prototype.getIndex=function(){return this.index_},e.prototype.fullLimitUpdateChild_=function(e,t,n,r,i){var o;if(this.reverse_){var s=this.index_.getCompare();o=function(e,t){return s(t,e)}}else o=this.index_.getCompare();var a=e;l(a.numChildren()===this.limit_,"");var u=new Vt(t,n),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(a.hasChild(t)){for(var d=a.getImmediateChild(t),p=r.getChildAfterChild(this.index_,c,this.reverse_);null!=p&&(p.name===t||a.hasChild(p.name));)p=r.getChildAfterChild(this.index_,p,this.reverse_);var f=null==p?1:o(p,u);if(h&&!n.isEmpty()&&f>=0)return null!=i&&i.trackChildChange(Pn(t,n,d)),a.updateImmediateChild(t,n);null!=i&&i.trackChildChange(Nn(t,d));var _=a.updateImmediateChild(t,yn.EMPTY_NODE);return null!=p&&this.rangedFilter_.matches(p)?(null!=i&&i.trackChildChange(Rn(p.name,p.node)),_.updateImmediateChild(p.name,p.node)):_}return n.isEmpty()?e:h&&o(c,u)>=0?(null!=i&&(i.trackChildChange(Nn(c.name,c.node)),i.trackChildChange(Rn(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(c.name,yn.EMPTY_NODE)):e},e}(),Dn=function(){function e(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ln}return e.prototype.hasStart=function(){return this.startSet_},e.prototype.hasStartAfter=function(){return this.startAfterSet_},e.prototype.hasEndBefore=function(){return this.endBeforeSet_},e.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_},e.prototype.getIndexStartValue=function(){return l(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},e.prototype.getIndexStartName=function(){return l(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:qe},e.prototype.hasEnd=function(){return this.endSet_},e.prototype.getIndexEndValue=function(){return l(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},e.prototype.getIndexEndName=function(){return l(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:je},e.prototype.hasLimit=function(){return this.limitSet_},e.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},e.prototype.getLimit=function(){return l(this.limitSet_,"Only valid if limit has been set"),this.limit_},e.prototype.getIndex=function(){return this.index_},e.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},e.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===ln},e.prototype.copy=function(){var t=new e;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},e}();function Ln(e,t,n){var r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function Mn(e,t,n){var r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function Fn(e,t){var n=e.copy();return n.index_=t,n}function qn(e){var t,n={};return e.isDefault()||(e.index_===ln?t="$priority":e.index_===Cn?t="$value":e.index_===Kt?t="$key":(l(e.index_ instanceof bn,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=I(t),e.startSet_&&(n.startAt=I(e.indexStartValue_),e.startNameSet_&&(n.startAt+=","+I(e.indexStartName_))),e.endSet_&&(n.endAt=I(e.indexEndValue_),e.endNameSet_&&(n.endAt+=","+I(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_)),n}function jn(e){var t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_)),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_)),e.limitSet_){t.l=e.limit_;var n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==ln&&(t.i=e.index_.toString()),t}var Wn=function(e){function n(t,n,r,i){var o=e.call(this)||this;return o.repoInfo_=t,o.onDataUpdate_=n,o.authTokenProvider_=r,o.appCheckTokenProvider_=i,o.log_=Oe("p:rest:"),o.listens_={},o}return t(n,e),n.prototype.reportStats=function(e){throw new Error("Method not implemented.")},n.getListenId_=function(e,t){return void 0!==t?"tag$"+t:(l(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())},n.prototype.listen=function(e,t,r,i){var o=this,s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);var a=n.getListenId_(e,r),u={};this.listens_[a]=u;var c=qn(e._queryParams);this.restRequest_(s+".json",c,(function(e,t){var n=t;(404===e&&(n=null,e=null),null===e&&o.onDataUpdate_(s,n,!1,r),N(o.listens_,a)===u)&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)}))},n.prototype.unlisten=function(e,t){var r=n.getListenId_(e,t);delete this.listens_[r]},n.prototype.get=function(e){var t=this,n=qn(e._queryParams),r=e._path.toString(),i=new v;return this.restRequest_(r+".json",n,(function(e,n){var o=n;404===e&&(o=null,e=null),null===e?(t.onDataUpdate_(r,o,!1,null),i.resolve(o)):i.reject(new Error(o))})),i.promise},n.prototype.refreshAuthToken=function(e){},n.prototype.restRequest_=function(e,t,n){var r=this;return void 0===t&&(t={}),t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((function(i){var o=s(i,2),a=o[0],u=o[1];a&&a.accessToken&&(t.auth=a.accessToken),u&&u.token&&(t.ac=u.token);var c=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+e+"?ns="+r.repoInfo_.namespace+function(e){for(var t=[],n=function(e,n){Array.isArray(n)?n.forEach((function(n){t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))})):t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))},r=0,i=Object.entries(e);r<i.length;r++){var o=i[r];n(o[0],o[1])}return t.length?"&"+t.join("&"):""}(t);r.log_("Sending REST request for "+c);var l=new XMLHttpRequest;l.onreadystatechange=function(){if(n&&4===l.readyState){r.log_("REST Response for "+c+" received. status:",l.status,"response:",l.responseText);var e=null;if(l.status>=200&&l.status<300){try{e=S(l.responseText)}catch(e){Me("Failed to parse JSON response for "+c+": "+l.responseText)}n(null,e)}else 401!==l.status&&404!==l.status&&Me("Got unsuccessful REST response for "+c+" Status: "+l.status),n(l.status);n=null}},l.open("GET",c,!0),l.send()}))},n}(wt),Un=function(){function e(){this.rootNode_=yn.EMPTY_NODE}return e.prototype.getNode=function(e){return this.rootNode_.getChild(e)},e.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},e}();function Bn(){return{value:null,children:new Map}}function zn(e,t,n){if(At(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{var r=St(t);e.children.has(r)||e.children.set(r,Bn()),zn(e.children.get(r),t=kt(t),n)}}function Hn(e,t){if(At(t))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;var n=e.value;return e.value=null,n.forEachChild(ln,(function(t,n){zn(e,new Et(t),n)})),Hn(e,t)}if(e.children.size>0){var r=St(t);if(t=kt(t),e.children.has(r))Hn(e.children.get(r),t)&&e.children.delete(r);return 0===e.children.size}return!0}function Vn(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach((function(e,n){t(n,e)}))}(e,(function(e,r){Vn(r,new Et(t.toString()+"/"+e),n)}))}var Yn,Qn=function(){function e(e){this.collection_=e,this.last_=null}return e.prototype.get=function(){var e=this.collection_.get(),t=n({},e);return this.last_&&Ve(this.last_,(function(e,n){t[e]=t[e]-n})),this.last_=e,t},e}(),Kn=function(){function e(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Qn(e);var n=1e4+2e4*Math.random();Xe(this.reportStats_.bind(this),Math.floor(n))}return e.prototype.reportStats_=function(){var e=this,t=this.statsListener_.get(),n={},r=!1;Ve(t,(function(t,i){i>0&&R(e.statsToReport_,t)&&(n[t]=i,r=!0)})),r&&this.server_.reportStats(n),Xe(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},e}();function Gn(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Yn||(Yn={}));var $n,Jn=function(){function e(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Yn.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}return e.prototype.operationForChild=function(t){if(At(this.path)){if(null!=this.affectedTree.value)return l(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new Et(t));return new e(Tt(),n,this.revert)}return l(St(this.path)===t,"operationForChild called for unrelated child."),new e(kt(this.path),this.affectedTree,this.revert)},e}(),Xn=function(){function e(e,t){this.source=e,this.path=t,this.type=Yn.LISTEN_COMPLETE}return e.prototype.operationForChild=function(t){return At(this.path)?new e(this.source,Tt()):new e(this.source,kt(this.path))},e}(),Zn=function(){function e(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Yn.OVERWRITE}return e.prototype.operationForChild=function(t){return At(this.path)?new e(this.source,Tt(),this.snap.getImmediateChild(t)):new e(this.source,kt(this.path),this.snap)},e}(),er=function(){function e(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Yn.MERGE}return e.prototype.operationForChild=function(t){if(At(this.path)){var n=this.children.subtree(new Et(t));return n.isEmpty()?null:n.value?new Zn(this.source,Tt(),n.value):new e(this.source,Tt(),n)}return l(St(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new e(this.source,kt(this.path),this.children)},e.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},e}(),tr=function(){function e(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}return e.prototype.isFullyInitialized=function(){return this.fullyInitialized_},e.prototype.isFiltered=function(){return this.filtered_},e.prototype.isCompleteForPath=function(e){if(At(e))return this.isFullyInitialized()&&!this.filtered_;var t=St(e);return this.isCompleteForChild(t)},e.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},e.prototype.getNode=function(){return this.node_},e}(),nr=function(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()};function rr(e,t,n,r,i,o){var s=r.filter((function(e){return e.type===n}));s.sort((function(t,n){return function(e,t,n){if(null==t.childName||null==n.childName)throw h("Should only compare child_ events.");var r=new Vt(t.childName,t.snapshotNode),i=new Vt(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(e,t,n)})),s.forEach((function(n){var r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,o);i.forEach((function(i){i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))}))}))}function ir(e,t){return{eventCache:e,serverCache:t}}function or(e,t,n,r){return ir(new tr(t,n,r),e.serverCache)}function sr(e,t,n,r){return ir(e.eventCache,new tr(t,n,r))}function ar(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function ur(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}var cr=function(){function e(e,t){void 0===t&&($n||($n=new Xt(Ue)),t=$n),this.value=e,this.children=t}return e.fromObject=function(t){var n=new e(null);return Ve(t,(function(e,t){n=n.set(new Et(e),t)})),n},e.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},e.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:Tt(),value:this.value};if(At(e))return null;var n=St(e),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(kt(e),t);return null!=i?{path:xt(new Et(n),i.path),value:i.value}:null}return null},e.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,(function(){return!0}))},e.prototype.subtree=function(t){if(At(t))return this;var n=St(t),r=this.children.get(n);return null!==r?r.subtree(kt(t)):new e(null)},e.prototype.set=function(t,n){if(At(t))return new e(n,this.children);var r=St(t),i=(this.children.get(r)||new e(null)).set(kt(t),n),o=this.children.insert(r,i);return new e(this.value,o)},e.prototype.remove=function(t){if(At(t))return this.children.isEmpty()?new e(null):new e(null,this.children);var n=St(t),r=this.children.get(n);if(r){var i=r.remove(kt(t)),o=void 0;return o=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&o.isEmpty()?new e(null):new e(this.value,o)}return this},e.prototype.get=function(e){if(At(e))return this.value;var t=St(e),n=this.children.get(t);return n?n.get(kt(e)):null},e.prototype.setTree=function(t,n){if(At(t))return n;var r=St(t),i=(this.children.get(r)||new e(null)).setTree(kt(t),n),o=void 0;return o=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new e(this.value,o)},e.prototype.fold=function(e){return this.fold_(Tt(),e)},e.prototype.fold_=function(e,t){var n={};return this.children.inorderTraversal((function(r,i){n[r]=i.fold_(xt(e,r),t)})),t(e,this.value,n)},e.prototype.findOnPath=function(e,t){return this.findOnPath_(e,Tt(),t)},e.prototype.findOnPath_=function(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(At(e))return null;var i=St(e),o=this.children.get(i);return o?o.findOnPath_(kt(e),xt(t,i),n):null},e.prototype.foreachOnPath=function(e,t){return this.foreachOnPath_(e,Tt(),t)},e.prototype.foreachOnPath_=function(t,n,r){if(At(t))return this;this.value&&r(n,this.value);var i=St(t),o=this.children.get(i);return o?o.foreachOnPath_(kt(t),xt(n,i),r):new e(null)},e.prototype.foreach=function(e){this.foreach_(Tt(),e)},e.prototype.foreach_=function(e,t){this.children.inorderTraversal((function(n,r){r.foreach_(xt(e,n),t)})),this.value&&t(e,this.value)},e.prototype.foreachChild=function(e){this.children.inorderTraversal((function(t,n){n.value&&e(t,n.value)}))},e}(),lr=function(){function e(e){this.writeTree_=e}return e.empty=function(){return new e(new cr(null))},e}();function hr(e,t,n){if(At(t))return new lr(new cr(n));var r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){var i=r.path,o=r.value,s=Ot(i,t);return o=o.updateChild(s,n),new lr(e.writeTree_.set(i,o))}var a=new cr(n),u=e.writeTree_.setTree(t,a);return new lr(u)}function dr(e,t,n){var r=e;return Ve(n,(function(e,n){r=hr(r,xt(t,e),n)})),r}function pr(e,t){if(At(t))return lr.empty();var n=e.writeTree_.setTree(t,new cr(null));return new lr(n)}function fr(e,t){return null!=_r(e,t)}function _r(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(Ot(n.path,t)):null}function yr(e){var t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(ln,(function(e,n){t.push(new Vt(e,n))})):e.writeTree_.children.inorderTraversal((function(e,n){null!=n.value&&t.push(new Vt(e,n.value))})),t}function vr(e,t){if(At(t))return e;var n=_r(e,t);return new lr(null!=n?new cr(n):e.writeTree_.subtree(t))}function gr(e){return e.writeTree_.isEmpty()}function mr(e,t){return wr(Tt(),e.writeTree_,t)}function wr(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);var r=null;return t.children.inorderTraversal((function(t,i){".priority"===t?(l(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=wr(xt(e,t),i,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(xt(e,".priority"),r)),n}function br(e,t){return Dr(t,e)}function Cr(e,t){var n=e.allWrites.findIndex((function(e){return e.writeId===t}));l(n>=0,"removeWrite called with nonexistent writeId.");var r=e.allWrites[n];e.allWrites.splice(n,1);for(var i=r.visible,o=!1,s=e.allWrites.length-1;i&&s>=0;){var a=e.allWrites[s];a.visible&&(s>=n&&Er(a,r.path)?i=!1:Mt(r.path,a.path)&&(o=!0)),s--}if(i){if(o)return function(e){e.visibleWrites=Sr(e.allWrites,Tr,Tt()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;r.snap?e.visibleWrites=pr(e.visibleWrites,r.path):Ve(r.children,(function(t){e.visibleWrites=pr(e.visibleWrites,xt(r.path,t))}));return!0}return!1}function Er(e,t){if(e.snap)return Mt(e.path,t);for(var n in e.children)if(e.children.hasOwnProperty(n)&&Mt(xt(e.path,n),t))return!0;return!1}function Tr(e){return e.visible}function Sr(e,t,n){for(var r=lr.empty(),i=0;i<e.length;++i){var o=e[i];if(t(o)){var s=o.path,a=void 0;if(o.snap)Mt(n,s)?r=hr(r,a=Ot(n,s),o.snap):Mt(s,n)&&(a=Ot(s,n),r=hr(r,Tt(),o.snap.getChild(a)));else{if(!o.children)throw h("WriteRecord should have .snap or .children");if(Mt(n,s))r=dr(r,a=Ot(n,s),o.children);else if(Mt(s,n))if(At(a=Ot(s,n)))r=dr(r,Tt(),o.children);else{var u=N(o.children,St(a));if(u){var c=u.getChild(kt(a));r=hr(r,Tt(),c)}}}}}return r}function Ir(e,t,n,r,i){if(r||i){var o=vr(e.visibleWrites,t);if(!i&&gr(o))return n;if(i||null!=n||fr(o,Tt())){return mr(Sr(e.allWrites,(function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(Mt(e.path,t)||Mt(t,e.path))}),t),n||yn.EMPTY_NODE)}return null}var s=_r(e.visibleWrites,t);if(null!=s)return s;var a=vr(e.visibleWrites,t);return gr(a)?n:null!=n||fr(a,Tt())?mr(a,n||yn.EMPTY_NODE):null}function kr(e,t,n,r){return Ir(e.writeTree,e.treePath,t,n,r)}function Rr(e,t){return function(e,t,n){var r=yn.EMPTY_NODE,i=_r(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(ln,(function(e,t){r=r.updateImmediateChild(e,t)})),r;if(n){var o=vr(e.visibleWrites,t);return n.forEachChild(ln,(function(e,t){var n=mr(vr(o,new Et(e)),t);r=r.updateImmediateChild(e,n)})),yr(o).forEach((function(e){r=r.updateImmediateChild(e.name,e.node)})),r}return yr(vr(e.visibleWrites,t)).forEach((function(e){r=r.updateImmediateChild(e.name,e.node)})),r}(e.writeTree,e.treePath,t)}function Nr(e,t,n,r){return function(e,t,n,r,i){l(r||i,"Either existingEventSnap or existingServerSnap must exist");var o=xt(t,n);if(fr(e.visibleWrites,o))return null;var s=vr(e.visibleWrites,o);return gr(s)?i.getChild(n):mr(s,i.getChild(n))}(e.writeTree,e.treePath,t,n,r)}function Pr(e,t){return function(e,t){return _r(e.visibleWrites,t)}(e.writeTree,xt(e.treePath,t))}function xr(e,t,n,r,i,o){return function(e,t,n,r,i,o,s){var a,u=vr(e.visibleWrites,t),c=_r(u,Tt());if(null!=c)a=c;else{if(null==n)return[];a=mr(u,n)}if((a=a.withIndex(s)).isEmpty()||a.isLeafNode())return[];for(var l=[],h=s.getCompare(),d=o?a.getReverseIteratorFrom(r,s):a.getIteratorFrom(r,s),p=d.getNext();p&&l.length<i;)0!==h(p,r)&&l.push(p),p=d.getNext();return l}(e.writeTree,e.treePath,t,n,r,i,o)}function Ar(e,t,n){return function(e,t,n,r){var i=xt(t,n),o=_r(e.visibleWrites,i);return null!=o?o:r.isCompleteForChild(n)?mr(vr(e.visibleWrites,i),r.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function Or(e,t){return Dr(xt(e.treePath,t),e.writeTree)}function Dr(e,t){return{treePath:e,writeTree:t}}var Lr=function(){function e(){this.changeMap=new Map}return e.prototype.trackChildChange=function(e){var t=e.type,n=e.childName;l("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),l(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,Pn(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,Nn(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,Rn(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw h("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,Pn(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)},e.prototype.getChanges=function(){return Array.from(this.changeMap.values())},e}(),Mr=new(function(){function e(){}return e.prototype.getCompleteChild=function(e){return null},e.prototype.getChildAfterChild=function(e,t,n){return null},e}()),Fr=function(){function e(e,t,n){void 0===n&&(n=null),this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}return e.prototype.getCompleteChild=function(e){var t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new tr(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Ar(this.writes_,e,n)},e.prototype.getChildAfterChild=function(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:ur(this.viewCache_),i=xr(this.writes_,r,t,1,n,e);return 0===i.length?null:i[0]},e}();function qr(e,t,n,r,i){var o,s,a=new Lr;if(n.type===Yn.OVERWRITE){var u=n;u.source.fromUser?o=Ur(e,t,u.path,u.snap,r,i,a):(l(u.source.fromServer,"Unknown source."),s=u.source.tagged||t.serverCache.isFiltered()&&!At(u.path),o=Wr(e,t,u.path,u.snap,r,i,s,a))}else if(n.type===Yn.MERGE){var c=n;c.source.fromUser?o=function(e,t,n,r,i,o,s){var a=t;return r.foreach((function(r,u){var c=xt(n,r);Br(t,St(c))&&(a=Ur(e,a,c,u,i,o,s))})),r.foreach((function(r,u){var c=xt(n,r);Br(t,St(c))||(a=Ur(e,a,c,u,i,o,s))})),a}(e,t,c.path,c.children,r,i,a):(l(c.source.fromServer,"Unknown source."),s=c.source.tagged||t.serverCache.isFiltered(),o=Hr(e,t,c.path,c.children,r,i,s,a))}else if(n.type===Yn.ACK_USER_WRITE){var d=n;o=d.revert?function(e,t,n,r,i,o){var s;if(null!=Pr(r,n))return t;var a=new Fr(r,t,i),u=t.eventCache.getNode(),c=void 0;if(At(n)||".priority"===St(n)){var h=void 0;if(t.serverCache.isFullyInitialized())h=kr(r,ur(t));else{var d=t.serverCache.getNode();l(d instanceof yn,"serverChildren would be complete if leaf node"),h=Rr(r,d)}h=h,c=e.filter.updateFullNode(u,h,o)}else{var p=St(n),f=Ar(r,p,t.serverCache);null==f&&t.serverCache.isCompleteForChild(p)&&(f=u.getImmediateChild(p)),(c=null!=f?e.filter.updateChild(u,p,f,kt(n),a,o):t.eventCache.getNode().hasChild(p)?e.filter.updateChild(u,p,yn.EMPTY_NODE,kt(n),a,o):u).isEmpty()&&t.serverCache.isFullyInitialized()&&(s=kr(r,ur(t))).isLeafNode()&&(c=e.filter.updateFullNode(c,s,o))}return s=t.serverCache.isFullyInitialized()||null!=Pr(r,Tt()),or(t,c,s,e.filter.filtersNodes())}(e,t,d.path,r,i,a):function(e,t,n,r,i,o,s){if(null!=Pr(i,n))return t;var a=t.serverCache.isFiltered(),u=t.serverCache;if(null!=r.value){if(At(n)&&u.isFullyInitialized()||u.isCompleteForPath(n))return Wr(e,t,n,u.getNode().getChild(n),i,o,a,s);if(At(n)){var c=new cr(null);return u.getNode().forEachChild(Kt,(function(e,t){c=c.set(new Et(e),t)})),Hr(e,t,n,c,i,o,a,s)}return t}var l=new cr(null);return r.foreach((function(e,t){var r=xt(n,e);u.isCompleteForPath(r)&&(l=l.set(e,u.getNode().getChild(r)))})),Hr(e,t,n,l,i,o,a,s)}(e,t,d.path,d.affectedTree,r,i,a)}else{if(n.type!==Yn.LISTEN_COMPLETE)throw h("Unknown operation type: "+n.type);o=function(e,t,n,r,i){var o=t.serverCache,s=sr(t,o.getNode(),o.isFullyInitialized()||At(n),o.isFiltered());return jr(e,s,n,r,Mr,i)}(e,t,n.path,r,a)}var p=a.getChanges();return function(e,t,n){var r=t.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=ar(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(kn(ar(t)))}}(t,o,p),{viewCache:o,changes:p}}function jr(e,t,n,r,i,o){var s=t.eventCache;if(null!=Pr(r,n))return t;var a=void 0,u=void 0;if(At(n))if(l(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){var c=ur(t),h=Rr(r,c instanceof yn?c:yn.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),h,o)}else{var d=kr(r,ur(t));a=e.filter.updateFullNode(t.eventCache.getNode(),d,o)}else{var p=St(n);if(".priority"===p){l(1===It(n),"Can't have a priority with additional path components");var f=s.getNode(),_=Nr(r,n,f,u=t.serverCache.getNode());a=null!=_?e.filter.updatePriority(f,_):s.getNode()}else{var y=kt(n),v=void 0;if(s.isCompleteForChild(p)){u=t.serverCache.getNode();var g=Nr(r,n,s.getNode(),u);v=null!=g?s.getNode().getImmediateChild(p).updateChild(y,g):s.getNode().getImmediateChild(p)}else v=Ar(r,p,t.serverCache);a=null!=v?e.filter.updateChild(s.getNode(),p,v,y,i,o):s.getNode()}}return or(t,a,s.isFullyInitialized()||At(n),e.filter.filtersNodes())}function Wr(e,t,n,r,i,o,s,a){var u,c=t.serverCache,l=s?e.filter:e.filter.getIndexedFilter();if(At(n))u=l.updateFullNode(c.getNode(),r,null);else if(l.filtersNodes()&&!c.isFiltered()){var h=c.getNode().updateChild(n,r);u=l.updateFullNode(c.getNode(),h,null)}else{var d=St(n);if(!c.isCompleteForPath(n)&&It(n)>1)return t;var p=kt(n),f=c.getNode().getImmediateChild(d).updateChild(p,r);u=".priority"===d?l.updatePriority(c.getNode(),f):l.updateChild(c.getNode(),d,f,p,Mr,null)}var _=sr(t,u,c.isFullyInitialized()||At(n),l.filtersNodes());return jr(e,_,n,i,new Fr(i,_,o),a)}function Ur(e,t,n,r,i,o,s){var a,u,c=t.eventCache,l=new Fr(i,t,o);if(At(n))u=e.filter.updateFullNode(t.eventCache.getNode(),r,s),a=or(t,u,!0,e.filter.filtersNodes());else{var h=St(n);if(".priority"===h)u=e.filter.updatePriority(t.eventCache.getNode(),r),a=or(t,u,c.isFullyInitialized(),c.isFiltered());else{var d=kt(n),p=c.getNode().getImmediateChild(h),f=void 0;if(At(d))f=r;else{var _=l.getCompleteChild(h);f=null!=_?".priority"===Rt(d)&&_.getChild(Pt(d)).isEmpty()?_:_.updateChild(d,r):yn.EMPTY_NODE}if(p.equals(f))a=t;else a=or(t,e.filter.updateChild(c.getNode(),h,f,d,l,s),c.isFullyInitialized(),e.filter.filtersNodes())}}return a}function Br(e,t){return e.eventCache.isCompleteForChild(t)}function zr(e,t,n){return n.foreach((function(e,n){t=t.updateChild(e,n)})),t}function Hr(e,t,n,r,i,o,s,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;var u,c=t;u=At(n)?r:new cr(null).setTree(n,r);var l=t.serverCache.getNode();return u.children.inorderTraversal((function(n,r){if(l.hasChild(n)){var u=zr(0,t.serverCache.getNode().getImmediateChild(n),r);c=Wr(e,c,new Et(n),u,i,o,s,a)}})),u.children.inorderTraversal((function(n,r){var u=!t.serverCache.isCompleteForChild(n)&&void 0===r.value;if(!l.hasChild(n)&&!u){var h=zr(0,t.serverCache.getNode().getImmediateChild(n),r);c=Wr(e,c,new Et(n),h,i,o,s,a)}})),c}var Vr,Yr=function(){function e(e,t){this.query_=e,this.eventRegistrations_=[];var n,r=this.query_._queryParams,i=new xn(r.getIndex()),o=(n=r).loadsAllData()?new xn(n.getIndex()):n.hasLimit()?new On(n):new An(n);this.processor_=function(e){return{filter:e}}(o);var s=t.serverCache,a=t.eventCache,u=i.updateFullNode(yn.EMPTY_NODE,s.getNode(),null),c=o.updateFullNode(yn.EMPTY_NODE,a.getNode(),null),l=new tr(u,s.isFullyInitialized(),i.filtersNodes()),h=new tr(c,a.isFullyInitialized(),o.filtersNodes());this.viewCache_=ir(h,l),this.eventGenerator_=new nr(this.query_)}return Object.defineProperty(e.prototype,"query",{get:function(){return this.query_},enumerable:!1,configurable:!0}),e}();function Qr(e,t){var n=ur(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!At(t)&&!n.getImmediateChild(St(t)).isEmpty())?n.getChild(t):null}function Kr(e){return 0===e.eventRegistrations_.length}function Gr(e,t,n){var r=[];if(n){l(null==t,"A cancel should cancel all event registrations.");var i=e.query._path;e.eventRegistrations_.forEach((function(e){var t=e.createCancelEvent(n,i);t&&r.push(t)}))}if(t){for(var o=[],s=0;s<e.eventRegistrations_.length;++s){var a=e.eventRegistrations_[s];if(a.matches(t)){if(t.hasAnyCallback()){o=o.concat(e.eventRegistrations_.slice(s+1));break}}else o.push(a)}e.eventRegistrations_=o}else e.eventRegistrations_=[];return r}function $r(e,t,n,r){t.type===Yn.MERGE&&null!==t.source.queryId&&(l(ur(e.viewCache_),"We should always have a full cache before handling merges"),l(ar(e.viewCache_),"Missing event cache, even though we have a server cache"));var i,o,s=e.viewCache_,a=qr(e.processor_,s,t,n,r);return i=e.processor_,o=a.viewCache,l(o.eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),l(o.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed"),l(a.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,Jr(e,a.changes,a.viewCache.eventCache.getNode(),null)}function Jr(e,t,n,r){var i=r?[r]:e.eventRegistrations_;return function(e,t,n,r){var i=[],o=[];return t.forEach((function(t){var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),rr(e,i,"child_removed",t,r,n),rr(e,i,"child_added",t,r,n),rr(e,i,"child_moved",o,r,n),rr(e,i,"child_changed",t,r,n),rr(e,i,"value",t,r,n),i}(e.eventGenerator_,t,n,i)}var Xr,Zr=function(){this.views=new Map};function ei(e,t,n,r){var i,s,a=t.source.queryId;if(null!==a){var u=e.views.get(a);return l(null!=u,"SyncTree gave us an op for an invalid query."),$r(u,t,n,r)}var c=[];try{for(var h=o(e.views.values()),d=h.next();!d.done;d=h.next()){u=d.value;c=c.concat($r(u,t,n,r))}}catch(e){i={error:e}}finally{try{d&&!d.done&&(s=h.return)&&s.call(h)}finally{if(i)throw i.error}}return c}function ti(e,t,n,r,i){var o=t._queryIdentifier,s=e.views.get(o);if(!s){var a=kr(n,i?r:null),u=!1;a?u=!0:r instanceof yn?(a=Rr(n,r),u=!1):(a=yn.EMPTY_NODE,u=!1);var c=ir(new tr(a,u,!1),new tr(r,i,!1));return new Yr(t,c)}return s}function ni(e,t,n,r,i,o){var s=ti(e,t,r,i,o);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,s),function(e,t){e.eventRegistrations_.push(t)}(s,n),function(e,t){var n=e.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(ln,(function(e,t){r.push(Rn(e,t))})),n.isFullyInitialized()&&r.push(kn(n.getNode())),Jr(e,r,n.getNode(),t)}(s,n)}function ri(e,t,n,r){var i,a,u=t._queryIdentifier,c=[],h=[],d=ui(e);if("default"===u)try{for(var p=o(e.views.entries()),f=p.next();!f.done;f=p.next()){var _=s(f.value,2),y=_[0],v=_[1];h=h.concat(Gr(v,n,r)),Kr(v)&&(e.views.delete(y),v.query._queryParams.loadsAllData()||c.push(v.query))}}catch(e){i={error:e}}finally{try{f&&!f.done&&(a=p.return)&&a.call(p)}finally{if(i)throw i.error}}else(v=e.views.get(u))&&(h=h.concat(Gr(v,n,r)),Kr(v)&&(e.views.delete(u),v.query._queryParams.loadsAllData()||c.push(v.query)));return d&&!ui(e)&&c.push(new(l(Vr,"Reference.ts has not been loaded"),Vr)(t._repo,t._path)),{removed:c,events:h}}function ii(e){var t,n,r=[];try{for(var i=o(e.views.values()),s=i.next();!s.done;s=i.next()){var a=s.value;a.query._queryParams.loadsAllData()||r.push(a)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}function oi(e,t){var n,r,i=null;try{for(var s=o(e.views.values()),a=s.next();!a.done;a=s.next()){var u=a.value;i=i||Qr(u,t)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return i}function si(e,t){if(t._queryParams.loadsAllData())return ci(e);var n=t._queryIdentifier;return e.views.get(n)}function ai(e,t){return null!=si(e,t)}function ui(e){return null!=ci(e)}function ci(e){var t,n;try{for(var r=o(e.views.values()),i=r.next();!i.done;i=r.next()){var s=i.value;if(s.query._queryParams.loadsAllData())return s}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return null}var li=1,hi=function(e){this.listenProvider_=e,this.syncPointTree_=new cr(null),this.pendingWriteTree_={visibleWrites:lr.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map};function di(e,t,n,r,i){return function(e,t,n,r,i){l(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:i}),i&&(e.visibleWrites=hr(e.visibleWrites,t,n)),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r,i),i?wi(e,new Zn({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function pi(e,t,n,r){!function(e,t,n,r){l(r>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:t,children:n,writeId:r,visible:!0}),e.visibleWrites=dr(e.visibleWrites,t,n),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r);var i=cr.fromObject(n);return wi(e,new er({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,i))}function fi(e,t,n){void 0===n&&(n=!1);var r=function(e,t){for(var n=0;n<e.allWrites.length;n++){var r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(Cr(e.pendingWriteTree_,t)){var i=new cr(null);return null!=r.snap?i=i.set(Tt(),!0):Ve(r.children,(function(e){i=i.set(new Et(e),!0)})),wi(e,new Jn(r.path,i,n))}return[]}function _i(e,t,n){return wi(e,new Zn({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function yi(e,t,n,r){var i=t._path,o=e.syncPointTree_.get(i),s=[];if(o&&("default"===t._queryIdentifier||ai(o,t))){var a=ri(o,t,n,r);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(i));var u=a.removed;s=a.events;var c=-1!==u.findIndex((function(e){return e._queryParams.loadsAllData()})),l=e.syncPointTree_.findOnPath(i,(function(e,t){return ui(t)}));if(c&&!l){var h=e.syncPointTree_.subtree(i);if(!h.isEmpty())for(var d=function(e){return e.fold((function(e,t,n){if(t&&ui(t))return[ci(t)];var r=[];return t&&(r=ii(t)),Ve(n,(function(e,t){r=r.concat(t)})),r}))}(h),p=0;p<d.length;++p){var f=d[p],_=f.query,y=Ei(e,f);e.listenProvider_.startListening(Ni(_),Ti(e,_),y.hashFn,y.onComplete)}}if(!l&&u.length>0&&!r)if(c){e.listenProvider_.stopListening(Ni(t),null)}else u.forEach((function(t){var n=e.queryToTagMap.get(Si(t));e.listenProvider_.stopListening(Ni(t),n)}));!function(e,t){for(var n=0;n<t.length;++n){var r=t[n];if(!r._queryParams.loadsAllData()){var i=Si(r),o=e.queryToTagMap.get(i);e.queryToTagMap.delete(i),e.tagToQueryMap.delete(o)}}}(e,u)}return s}function vi(e,t,n){var r=t._path,i=null,o=!1;e.syncPointTree_.foreachOnPath(r,(function(e,t){var n=Ot(e,r);i=i||oi(t,n),o=o||ui(t)}));var s,a=e.syncPointTree_.get(r);(a?(o=o||ui(a),i=i||oi(a,Tt())):(a=new Zr,e.syncPointTree_=e.syncPointTree_.set(r,a)),null!=i)?s=!0:(s=!1,i=yn.EMPTY_NODE,e.syncPointTree_.subtree(r).foreachChild((function(e,t){var n=oi(t,Tt());n&&(i=i.updateImmediateChild(e,n))})));var u=ai(a,t);if(!u&&!t._queryParams.loadsAllData()){var c=Si(t);l(!e.queryToTagMap.has(c),"View does not exist, but we have a tag");var h=li++;e.queryToTagMap.set(c,h),e.tagToQueryMap.set(h,c)}var d=ni(a,t,n,br(e.pendingWriteTree_,r),i,s);if(!u&&!o){var p=si(a,t);d=d.concat(function(e,t,n){var r=t._path,i=Ti(e,t),o=Ei(e,n),s=e.listenProvider_.startListening(Ni(t),i,o.hashFn,o.onComplete),a=e.syncPointTree_.subtree(r);if(i)l(!ui(a.value),"If we're adding a query, it shouldn't be shadowed");else for(var u=a.fold((function(e,t,n){if(!At(e)&&t&&ui(t))return[ci(t).query];var r=[];return t&&(r=r.concat(ii(t).map((function(e){return e.query})))),Ve(n,(function(e,t){r=r.concat(t)})),r})),c=0;c<u.length;++c){var h=u[c];e.listenProvider_.stopListening(Ni(h),Ti(e,h))}return s}(e,t,p))}return d}function gi(e,t,n){var r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(function(e,n){var r=oi(n,Ot(e,t));if(r)return r}));return Ir(r,t,i,n,!0)}function mi(e,t){var n=t._path,r=null;e.syncPointTree_.foreachOnPath(n,(function(e,t){var i=Ot(e,n);r=r||oi(t,i)}));var i=e.syncPointTree_.get(n);i?r=r||oi(i,Tt()):(i=new Zr,e.syncPointTree_=e.syncPointTree_.set(n,i));var o=null!=r,s=o?new tr(r,!0,!1):null;return function(e){return ar(e.viewCache_)}(ti(i,t,br(e.pendingWriteTree_,t._path),o?s.getNode():yn.EMPTY_NODE,o))}function wi(e,t){return bi(t,e.syncPointTree_,null,br(e.pendingWriteTree_,Tt()))}function bi(e,t,n,r){if(At(e.path))return Ci(e,t,n,r);var i=t.get(Tt());null==n&&null!=i&&(n=oi(i,Tt()));var o=[],s=St(e.path),a=e.operationForChild(s),u=t.children.get(s);if(u&&a){var c=n?n.getImmediateChild(s):null,l=Or(r,s);o=o.concat(bi(a,u,c,l))}return i&&(o=o.concat(ei(i,e,r,n))),o}function Ci(e,t,n,r){var i=t.get(Tt());null==n&&null!=i&&(n=oi(i,Tt()));var o=[];return t.children.inorderTraversal((function(t,i){var s=n?n.getImmediateChild(t):null,a=Or(r,t),u=e.operationForChild(t);u&&(o=o.concat(Ci(u,i,s,a)))})),i&&(o=o.concat(ei(i,e,r,n))),o}function Ei(e,t){var n=t.query,r=Ti(e,n);return{hashFn:function(){return(function(e){return e.viewCache_.serverCache.getNode()}(t)||yn.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return r?function(e,t,n){var r=Ii(e,n);if(r){var i=ki(r),o=i.path,s=i.queryId,a=Ot(o,t);return Ri(e,o,new Xn(Gn(s),a))}return[]}(e,n._path,r):function(e,t){return wi(e,new Xn({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n._path);var i=function(e,t){var n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");var r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(t,n);return yi(e,n,null,i)}}}function Ti(e,t){var n=Si(t);return e.queryToTagMap.get(n)}function Si(e){return e._path.toString()+"$"+e._queryIdentifier}function Ii(e,t){return e.tagToQueryMap.get(t)}function ki(e){var t=e.indexOf("$");return l(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Et(e.substr(0,t))}}function Ri(e,t,n){var r=e.syncPointTree_.get(t);return l(r,"Missing sync point for query tag that we're tracking"),ei(r,n,br(e.pendingWriteTree_,t),null)}function Ni(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(l(Xr,"Reference.ts has not been loaded"),Xr)(e._repo,e._path):e}var Pi=function(){function e(e){this.node_=e}return e.prototype.getImmediateChild=function(t){return new e(this.node_.getImmediateChild(t))},e.prototype.node=function(){return this.node_},e}(),xi=function(){function e(e,t){this.syncTree_=e,this.path_=t}return e.prototype.getImmediateChild=function(t){var n=xt(this.path_,t);return new e(this.syncTree_,n)},e.prototype.node=function(){return gi(this.syncTree_,this.path_)},e}(),Ai=function(e,t,n){return e&&"object"==typeof e?(l(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?Oi(e[".sv"],t,n):"object"==typeof e[".sv"]?Di(e[".sv"],t):void l(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},Oi=function(e,t,n){switch(e){case"timestamp":return n.timestamp;default:l(!1,"Unexpected server value: "+e)}},Di=function(e,t,n){e.hasOwnProperty("increment")||l(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e.increment;"number"!=typeof r&&l(!1,"Unexpected increment value: "+r);var i=t.node();if(l(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;var o=i.getValue();return"number"!=typeof o?r:o+r},Li=function(e,t,n,r){return Fi(t,new xi(n,e),r)},Mi=function(e,t,n){return Fi(e,new Pi(t),n)};function Fi(e,t,n){var r,i=e.getPriority().val(),o=Ai(i,t.getImmediateChild(".priority"),n);if(e.isLeafNode()){var s=e,a=Ai(s.getValue(),t,n);return a!==s.getValue()||o!==s.getPriority().val()?new an(a,gn(o)):e}var u=e;return r=u,o!==u.getPriority().val()&&(r=r.updatePriority(new an(o))),u.forEachChild(ln,(function(e,i){var o=Fi(i,t.getImmediateChild(e),n);o!==i&&(r=r.updateImmediateChild(e,o))})),r}var qi=function(e,t,n){void 0===e&&(e=""),void 0===t&&(t=null),void 0===n&&(n={children:{},childCount:0}),this.name=e,this.parent=t,this.node=n};function ji(e,t){for(var n=t instanceof Et?t:new Et(t),r=e,i=St(n);null!==i;){var o=N(r.node.children,i)||{children:{},childCount:0};r=new qi(i,r,o),i=St(n=kt(n))}return r}function Wi(e){return e.node.value}function Ui(e,t){e.node.value=t,Yi(e)}function Bi(e){return e.node.childCount>0}function zi(e,t){Ve(e.node.children,(function(n,r){t(new qi(n,e,r))}))}function Hi(e,t,n,r){n&&!r&&t(e),zi(e,(function(e){Hi(e,t,!0,r)})),n&&r&&t(e)}function Vi(e){return new Et(null===e.parent?e.name:Vi(e.parent)+"/"+e.name)}function Yi(e){null!==e.parent&&function(e,t,n){var r=function(e){return void 0===Wi(e)&&!Bi(e)}(n),i=R(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,Yi(e)):r||i||(e.node.children[t]=n.node,e.node.childCount++,Yi(e))}(e.parent,e.name,e)}var Qi=/[\[\].#$\/\u0000-\u001F\u007F]/,Ki=/[\[\].#$\u0000-\u001F\u007F]/,Gi=10485760,$i=function(e){return"string"==typeof e&&0!==e.length&&!Qi.test(e)},Ji=function(e){return"string"==typeof e&&0!==e.length&&!Ki.test(e)},Xi=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!Fe(e)||e&&"object"==typeof e&&R(e,".sv")},Zi=function(e,t,n,r){r&&void 0===t||eo(F(e,"value"),t,n)},eo=function(e,t,n){var r=n instanceof Et?new Ft(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+jt(r));if("function"==typeof t)throw new Error(e+"contains a function "+jt(r)+" with contents = "+t.toString());if(Fe(t))throw new Error(e+"contains "+t.toString()+" "+jt(r));if("string"==typeof t&&t.length>Gi/3&&W(t)>Gi)throw new Error(e+"contains a string greater than "+"10485760 utf8 bytes "+jt(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var i=!1,o=!1;if(Ve(t,(function(t,n){if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(o=!0,!$i(t)))throw new Error(e+" contains an invalid key ("+t+") "+jt(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var s,a;!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=W(t),qt(e)}(r,t),eo(e,n,r),a=(s=r).parts_.pop(),s.byteLength_-=W(a),s.parts_.length>0&&(s.byteLength_-=1)})),i&&o)throw new Error(e+' contains ".value" child '+jt(r)+" in addition to actual children.")}},to=function(e,t,n,r){if(!r||void 0!==t){var i=F(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");var o=[];Ve(t,(function(e,t){var r=new Et(e);if(eo(i,t,xt(n,r)),".priority"===Rt(r)&&!Xi(t))throw new Error(i+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");o.push(r)})),function(e,t){var n,r;for(n=0;n<t.length;n++)for(var i=Nt(r=t[n]),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!$i(i[o]))throw new Error(e+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');t.sort(Dt);var s=null;for(n=0;n<t.length;n++){if(r=t[n],null!==s&&Mt(s,r))throw new Error(e+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}}(i,o)}},no=function(e,t,n){if(!n||void 0!==t){if(Fe(t))throw new Error(F(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Xi(t))throw new Error(F(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},ro=function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(F(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},io=function(e,t,n,r){if(!(r&&void 0===n||$i(n)))throw new Error(F(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},oo=function(e,t,n,r){if(!(r&&void 0===n||Ji(n)))throw new Error(F(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},so=function(e,t){if(".info"===St(t))throw new Error(e+" failed = Can't modify data under /.info/")},ao=function(e,t){var n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!$i(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Ji(e)}(n))throw new Error(F(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},uo=function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(F(e,t)+"must be a boolean.")},co=function(){this.eventLists_=[],this.recursionDepth_=0};function lo(e,t){for(var n=null,r=0;r<t.length;r++){var i=t[r],o=i.getPath();null===n||Lt(o,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:o}),n.events.push(i)}n&&e.eventLists_.push(n)}function ho(e,t,n){lo(e,n),fo(e,(function(e){return Lt(e,t)}))}function po(e,t,n){lo(e,n),fo(e,(function(e){return Mt(e,t)||Mt(t,e)}))}function fo(e,t){e.recursionDepth_++;for(var n=!0,r=0;r<e.eventLists_.length;r++){var i=e.eventLists_[r];if(i)t(i.path)?(_o(e.eventLists_[r]),e.eventLists_[r]=null):n=!1}n&&(e.eventLists_=[]),e.recursionDepth_--}function _o(e){for(var t=0;t<e.events.length;t++){var n=e.events[t];if(null!==n){e.events[t]=null;var r=n.getEventRunner();Ne&&Ae("event: "+n.toString()),Je(r)}}}var yo="repo_interrupt",vo=function(){function e(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new co,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Bn(),this.transactionQueueTree_=new qi,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}return e.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},e}();function go(e,t,n){if(e.stats_=lt(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new Wn(e.repoInfo_,(function(t,n,r,i){bo(e,t,n,r,i)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((function(){return Co(e,!0)}),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{I(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new Ht(e.repoInfo_,t,(function(t,n,r,i){bo(e,t,n,r,i)}),(function(t){Co(e,t)}),(function(t){!function(e,t){Ve(t,(function(t,n){Eo(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}var r,i,o;e.authTokenProvider_.addTokenChangeListener((function(t){e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((function(t){e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=(r=e.repoInfo_,i=function(){return new Kn(e.stats_,e.server_)},o=r.toString(),ct[o]||(ct[o]=i()),ct[o]),e.infoData_=new Un,e.infoSyncTree_=new hi({startListening:function(t,n,r,i){var o=[],s=e.infoData_.getNode(t._path);return s.isEmpty()||(o=_i(e.infoSyncTree_,t._path,s),setTimeout((function(){i("ok")}),0)),o},stopListening:function(){}}),Eo(e,"connected",!1),e.serverSyncTree_=new hi({startListening:function(t,n,r,i){return e.server_.listen(t,r,n,(function(n,r){var o=i(n,r);po(e.eventQueue_,t._path,o)})),[]},stopListening:function(t,n){e.server_.unlisten(t,n)}})}function mo(e){var t=e.infoData_.getNode(new Et(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function wo(e){return function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e}({timestamp:mo(e)})}function bo(e,t,n,r,i){e.dataUpdateCount++;var o=new Et(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;var s=[];if(i)if(r){var a=x(n,(function(e){return gn(e)}));s=function(e,t,n,r){var i=Ii(e,r);if(i){var o=ki(i),s=o.path,a=o.queryId,u=Ot(s,t),c=cr.fromObject(n);return Ri(e,s,new er(Gn(a),u,c))}return[]}(e.serverSyncTree_,o,a,i)}else{var u=gn(n);s=function(e,t,n,r){var i=Ii(e,r);if(null!=i){var o=ki(i),s=o.path,a=o.queryId,u=Ot(s,t);return Ri(e,s,new Zn(Gn(a),u,n))}return[]}(e.serverSyncTree_,o,u,i)}else if(r){var c=x(n,(function(e){return gn(e)}));s=function(e,t,n){var r=cr.fromObject(n);return wi(e,new er({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,r))}(e.serverSyncTree_,o,c)}else{var l=gn(n);s=_i(e.serverSyncTree_,o,l)}var h=o;s.length>0&&(h=Do(e,o)),po(e.eventQueue_,h,s)}function Co(e,t){Eo(e,"connected",t),!1===t&&function(e){Po(e,"onDisconnectEvents");var t=wo(e),n=Bn();Vn(e.onDisconnect_,Tt(),(function(r,i){var o=Li(r,i,e.serverSyncTree_,t);zn(n,r,o)}));var r=[];Vn(n,Tt(),(function(t,n){r=r.concat(_i(e.serverSyncTree_,t,n));var i=jo(e,t);Do(e,i)})),e.onDisconnect_=Bn(),po(e.eventQueue_,Tt(),r)}(e)}function Eo(e,t,n){var r=new Et("/.info/"+t),i=gn(n);e.infoData_.updateSnapshot(r,i);var o=_i(e.infoSyncTree_,r,i);po(e.eventQueue_,r,o)}function To(e){return e.nextWriteId_++}function So(e,t,n,r,i){Po(e,"set",{path:t.toString(),value:n,priority:r});var o=wo(e),s=gn(n,r),a=gi(e.serverSyncTree_,t),u=Mi(s,a,o),c=To(e),l=di(e.serverSyncTree_,t,u,c,!0);lo(e.eventQueue_,l),e.server_.put(t.toString(),s.val(!0),(function(n,r){var o="ok"===n;o||Me("set at "+t+" failed: "+n);var s=fi(e.serverSyncTree_,c,!o);po(e.eventQueue_,t,s),xo(e,i,n,r)}));var h=jo(e,t);Do(e,h),po(e.eventQueue_,h,[])}function Io(e,t,n){e.server_.onDisconnectCancel(t.toString(),(function(r,i){"ok"===r&&Hn(e.onDisconnect_,t),xo(e,n,r,i)}))}function ko(e,t,n,r){var i=gn(n);e.server_.onDisconnectPut(t.toString(),i.val(!0),(function(n,o){"ok"===n&&zn(e.onDisconnect_,t,i),xo(e,r,n,o)}))}function Ro(e,t,n){var r;r=".info"===St(t._path)?yi(e.infoSyncTree_,t,n):yi(e.serverSyncTree_,t,n),ho(e.eventQueue_,t._path,r)}function No(e){e.persistentConnection_&&e.persistentConnection_.interrupt(yo)}function Po(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r="";e.persistentConnection_&&(r=e.persistentConnection_.id+":"),Ae.apply(void 0,a([r],s(t)))}function xo(e,t,n,r){t&&Je((function(){if("ok"===n)t(null);else{var e=(n||"error").toUpperCase(),i=e;r&&(i+=": "+r);var o=new Error(i);o.code=e,t(o)}}))}function Ao(e,t,n){return gi(e.serverSyncTree_,t,n)||yn.EMPTY_NODE}function Oo(e,t){if(void 0===t&&(t=e.transactionQueueTree_),t||qo(e,t),Wi(t)){var n=Mo(e,t);l(n.length>0,"Sending zero length transaction queue"),n.every((function(e){return 0===e.status}))&&function(e,t,n){for(var r=n.map((function(e){return e.currentWriteId})),i=Ao(e,t,r),o=i,s=i.hash(),a=0;a<n.length;a++){var u=n[a];l(0===u.status,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;var c=Ot(t,u.path);o=o.updateChild(c,u.currentOutputSnapshotRaw)}var h=o.val(!0),d=t;e.server_.put(d.toString(),h,(function(r){Po(e,"transaction put response",{path:d.toString(),status:r});var i=[];if("ok"===r){for(var o=[],s=function(t){n[t].status=2,i=i.concat(fi(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&o.push((function(){return n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)})),n[t].unwatcher()},a=0;a<n.length;a++)s(a);qo(e,ji(e.transactionQueueTree_,t)),Oo(e,e.transactionQueueTree_),po(e.eventQueue_,t,i);for(a=0;a<o.length;a++)Je(o[a])}else{if("datastale"===r)for(a=0;a<n.length;a++)3===n[a].status?n[a].status=4:n[a].status=0;else{Me("transaction at "+d.toString()+" failed: "+r);for(a=0;a<n.length;a++)n[a].status=4,n[a].abortReason=r}Do(e,t)}}),s)}(e,Vi(t),n)}else Bi(t)&&zi(t,(function(t){Oo(e,t)}))}function Do(e,t){var n=Lo(e,t),r=Vi(n);return function(e,t,n){if(0===t.length)return;for(var r=[],i=[],o=t.filter((function(e){return 0===e.status})).map((function(e){return e.currentWriteId})),s=function(s){var a,u,c=t[s],h=Ot(n,c.path),d=!1;if(l(null!==h,"rerunTransactionsUnderNode_: relativePath should not be null."),4===c.status)d=!0,a=c.abortReason,i=i.concat(fi(e.serverSyncTree_,c.currentWriteId,!0));else if(0===c.status)if(c.retryCount>=25)d=!0,a="maxretry",i=i.concat(fi(e.serverSyncTree_,c.currentWriteId,!0));else{var p=Ao(e,c.path,o);c.currentInputSnapshot=p;var f=t[s].update(p.val());if(void 0!==f){eo("transaction failed: Data returned ",f,c.path);var _=gn(f);"object"==typeof f&&null!=f&&R(f,".priority")||(_=_.updatePriority(p.getPriority()));var y=c.currentWriteId,v=wo(e),g=Mi(_,p,v);c.currentOutputSnapshotRaw=_,c.currentOutputSnapshotResolved=g,c.currentWriteId=To(e),o.splice(o.indexOf(y),1),i=(i=i.concat(di(e.serverSyncTree_,c.path,g,c.currentWriteId,c.applyLocally))).concat(fi(e.serverSyncTree_,y,!0))}else d=!0,a="nodata",i=i.concat(fi(e.serverSyncTree_,c.currentWriteId,!0))}po(e.eventQueue_,n,i),i=[],d&&(t[s].status=2,u=t[s].unwatcher,setTimeout(u,Math.floor(0)),t[s].onComplete&&("nodata"===a?r.push((function(){return t[s].onComplete(null,!1,t[s].currentInputSnapshot)})):r.push((function(){return t[s].onComplete(new Error(a),!1,null)}))))},a=0;a<t.length;a++)s(a);qo(e,e.transactionQueueTree_);for(a=0;a<r.length;a++)Je(r[a]);Oo(e,e.transactionQueueTree_)}(e,Mo(e,n),r),r}function Lo(e,t){var n,r=e.transactionQueueTree_;for(n=St(t);null!==n&&void 0===Wi(r);)r=ji(r,n),n=St(t=kt(t));return r}function Mo(e,t){var n=[];return Fo(e,t,n),n.sort((function(e,t){return e.order-t.order})),n}function Fo(e,t,n){var r=Wi(t);if(r)for(var i=0;i<r.length;i++)n.push(r[i]);zi(t,(function(t){Fo(e,t,n)}))}function qo(e,t){var n=Wi(t);if(n){for(var r=0,i=0;i<n.length;i++)2!==n[i].status&&(n[r]=n[i],r++);n.length=r,Ui(t,n.length>0?n:void 0)}zi(t,(function(t){qo(e,t)}))}function jo(e,t){var n=Vi(Lo(e,t)),r=ji(e.transactionQueueTree_,t);return function(e,t,n){for(var r=n?e:e.parent;null!==r;){if(t(r))return!0;r=r.parent}}(r,(function(t){Wo(e,t)})),Wo(e,r),Hi(r,(function(t){Wo(e,t)})),n}function Wo(e,t){var n=Wi(t);if(n){for(var r=[],i=[],o=-1,s=0;s<n.length;s++)3===n[s].status||(1===n[s].status?(l(o===s-1,"All SENT items should be at beginning of queue."),o=s,n[s].status=3,n[s].abortReason="set"):(l(0===n[s].status,"Unexpected transaction status in abort"),n[s].unwatcher(),i=i.concat(fi(e.serverSyncTree_,n[s].currentWriteId,!0)),n[s].onComplete&&r.push(n[s].onComplete.bind(null,new Error("set"),!1,null))));-1===o?Ui(t,void 0):n.length=o+1,po(e.eventQueue_,Vi(t),i);for(s=0;s<r.length;s++)Je(r[s])}}var Uo=function(e,t){var n=Bo(e),r=n.namespace;"firebase.com"===n.domain&&Le(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||Le("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Me("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new ot(n.host,n.secure,r,t,i,"",r!==n.subdomain),path:new Et(n.pathString)}},Bo=function(e){var t="",n="",r="",i="",s="",a=!0,u="https",c=443;if("string"==typeof e){var l=e.indexOf("//");l>=0&&(u=e.substring(0,l-1),e=e.substring(l+2));var h=e.indexOf("/");-1===h&&(h=e.length);var d=e.indexOf("?");-1===d&&(d=e.length),t=e.substring(0,Math.min(h,d)),h<d&&(i=function(e){for(var t="",n=e.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(h,d)));var p=function(e){var t,n,r={};"?"===e.charAt(0)&&(e=e.substring(1));try{for(var i=o(e.split("&")),s=i.next();!s.done;s=i.next()){var a=s.value;if(0!==a.length){var u=a.split("=");2===u.length?r[decodeURIComponent(u[0])]=decodeURIComponent(u[1]):Me("Invalid query segment '"+a+"' in query '"+e+"'")}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}(e.substring(Math.min(e.length,d)));(l=t.indexOf(":"))>=0?(a="https"===u||"wss"===u,c=parseInt(t.substring(l+1),10)):l=t.length;var f=t.slice(0,l);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{var _=t.indexOf(".");r=t.substring(0,_).toLowerCase(),n=t.substring(_+1),s=r}"ns"in p&&(s=p.ns)}return{host:t,port:c,domain:n,subdomain:r,secure:a,scheme:u,pathString:i,namespace:s}},zo=function(){function e(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}return e.prototype.getPath=function(){var e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path},e.prototype.getEventType=function(){return this.eventType},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+I(this.snapshot.exportVal())},e}(),Ho=function(){function e(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}return e.prototype.getPath=function(){return this.path},e.prototype.getEventType=function(){return"cancel"},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.path.toString()+":cancel"},e}(),Vo=function(){function e(e,t){this.snapshotCallback=e,this.cancelCallback=t}return e.prototype.onValue=function(e,t){this.snapshotCallback.call(null,e,t)},e.prototype.onCancel=function(e){return l(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)},Object.defineProperty(e.prototype,"hasCancelCallback",{get:function(){return!!this.cancelCallback},enumerable:!1,configurable:!0}),e.prototype.matches=function(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context},e}(),Yo=function(){function e(e,t){this._repo=e,this._path=t}return e.prototype.cancel=function(){var e=new v;return Io(this._repo,this._path,e.wrapCallback((function(){}))),e.promise},e.prototype.remove=function(){so("OnDisconnect.remove",this._path);var e=new v;return ko(this._repo,this._path,null,e.wrapCallback((function(){}))),e.promise},e.prototype.set=function(e){so("OnDisconnect.set",this._path),Zi("OnDisconnect.set",e,this._path,!1);var t=new v;return ko(this._repo,this._path,e,t.wrapCallback((function(){}))),t.promise},e.prototype.setWithPriority=function(e,t){so("OnDisconnect.setWithPriority",this._path),Zi("OnDisconnect.setWithPriority",e,this._path,!1),no("OnDisconnect.setWithPriority",t,!1);var n=new v;return function(e,t,n,r,i){var o=gn(n,r);e.server_.onDisconnectPut(t.toString(),o.val(!0),(function(n,r){"ok"===n&&zn(e.onDisconnect_,t,o),xo(0,i,n,r)}))}(this._repo,this._path,e,t,n.wrapCallback((function(){}))),n.promise},e.prototype.update=function(e){so("OnDisconnect.update",this._path),to("OnDisconnect.update",e,this._path,!1);var t=new v;return function(e,t,n,r){if(P(n))return Ae("onDisconnect().update() called with empty data.  Don't do anything."),void xo(0,r,"ok",void 0);e.server_.onDisconnectMerge(t.toString(),n,(function(i,o){"ok"===i&&Ve(n,(function(n,r){var i=gn(r);zn(e.onDisconnect_,xt(t,n),i)})),xo(0,r,i,o)}))}(this._repo,this._path,e,t.wrapCallback((function(){}))),t.promise},e}(),Qo=function(){function e(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}return Object.defineProperty(e.prototype,"key",{get:function(){return At(this._path)?null:Rt(this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ref",{get:function(){return new Jo(this._repo,this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_queryIdentifier",{get:function(){var e=jn(this._queryParams),t=ze(e);return"{}"===t?"default":t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_queryObject",{get:function(){return jn(this._queryParams)},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){if(!((t=U(t))instanceof e))return!1;var n=this._repo===t._repo,r=Lt(this._path,t._path),i=this._queryIdentifier===t._queryIdentifier;return n&&r&&i},e.prototype.toJSON=function(){return this.toString()},e.prototype.toString=function(){return this._repo.toString()+function(e){for(var t="",n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)},e}();function Ko(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function Go(e){var t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===Kt){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==qe)throw new Error(r);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==je)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(e.getIndex()===ln){if(null!=t&&!Xi(t)||null!=n&&!Xi(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(l(e.getIndex()instanceof bn||e.getIndex()===Cn,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function $o(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var Jo=function(e){function n(t,n){return e.call(this,t,n,new Dn,!1)||this}return t(n,e),Object.defineProperty(n.prototype,"parent",{get:function(){var e=Pt(this._path);return null===e?null:new n(this._repo,e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"root",{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e},enumerable:!1,configurable:!0}),n}(Qo),Xo=function(){function e(e,t,n){this._node=e,this.ref=t,this._index=n}return Object.defineProperty(e.prototype,"priority",{get:function(){return this._node.getPriority().val()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.ref.key},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._node.numChildren()},enumerable:!1,configurable:!0}),e.prototype.child=function(t){var n=new Et(t),r=ts(this.ref,t);return new e(this._node.getChild(n),r,ln)},e.prototype.exists=function(){return!this._node.isEmpty()},e.prototype.exportVal=function(){return this._node.val(!0)},e.prototype.forEach=function(t){var n=this;return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(function(r,i){return t(new e(i,ts(n.ref,r),ln))}))},e.prototype.hasChild=function(e){var t=new Et(e);return!this._node.getChild(t).isEmpty()},e.prototype.hasChildren=function(){return!this._node.isLeafNode()&&!this._node.isEmpty()},e.prototype.toJSON=function(){return this.exportVal()},e.prototype.val=function(){return this._node.val()},e}();function Zo(e,t){return(e=U(e))._checkNotDeleted("ref"),void 0!==t?ts(e._root,t):e._root}function es(e,t){(e=U(e))._checkNotDeleted("refFromURL");var n=Uo(t,e._repo.repoInfo_.nodeAdmin);ao("refFromURL",n);var r=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||r.host===e._repo.repoInfo_.host||Le("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+e._repo.repoInfo_.host+")"),Zo(e,n.path.toString())}function ts(e,t){var n,r,i,o;return null===St((e=U(e))._path)?(n="child",r="path",o=!1,(i=t)&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),oo(n,r,i,o)):oo("child","path",t,!1),new Jo(e._repo,xt(e._path,t))}function ns(e,t){e=U(e),so("push",e._path),Zi("push",t,e._path,!0);var n,r=mo(e._repo),i=Tn(r),o=ts(e,i),s=ts(e,i);return n=null!=t?is(s,t).then((function(){return s})):Promise.resolve(s),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),o}function rs(e){return so("remove",e._path),is(e,null)}function is(e,t){e=U(e),so("set",e._path),Zi("set",t,e._path,!1);var n=new v;return So(e._repo,e._path,t,null,n.wrapCallback((function(){}))),n.promise}function os(e,t){e=U(e),so("setPriority",e._path),no("setPriority",t,!1);var n=new v;return So(e._repo,xt(e._path,".priority"),t,null,n.wrapCallback((function(){}))),n.promise}function ss(e,t,n){if(so("setWithPriority",e._path),Zi("setWithPriority",t,e._path,!1),no("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";var r=new v;return So(e._repo,e._path,t,n,r.wrapCallback((function(){}))),r.promise}function as(e,t){to("update",t,e._path,!1);var n=new v;return function(e,t,n,r){Po(e,"update",{path:t.toString(),value:n});var i=!0,o=wo(e),s={};if(Ve(n,(function(n,r){i=!1,s[n]=Li(xt(t,n),gn(r),e.serverSyncTree_,o)})),i)Ae("update() called with empty data.  Don't do anything."),xo(0,r,"ok",void 0);else{var a=To(e),u=pi(e.serverSyncTree_,t,s,a);lo(e.eventQueue_,u),e.server_.merge(t.toString(),n,(function(n,i){var o="ok"===n;o||Me("update at "+t+" failed: "+n);var s=fi(e.serverSyncTree_,a,!o),u=s.length>0?Do(e,t):t;po(e.eventQueue_,u,s),xo(0,r,n,i)})),Ve(n,(function(n){var r=jo(e,xt(t,n));Do(e,r)})),po(e.eventQueue_,t,[])}}(e._repo,e._path,t,n.wrapCallback((function(){}))),n.promise}function us(e){return function(e,t){var n=mi(e.serverSyncTree_,t);return null!=n?Promise.resolve(n):e.server_.get(t).then((function(n){var r=gn(n),i=_i(e.serverSyncTree_,t._path,r);return ho(e.eventQueue_,t._path,i),Promise.resolve(r)}),(function(n){return Po(e,"get for query "+I(t)+" failed: "+n),Promise.reject(new Error(n))}))}((e=U(e))._repo,e).then((function(t){return new Xo(t,new Jo(e._repo,e._path),e._queryParams.getIndex())}))}var cs=function(){function e(e){this.callbackContext=e}return e.prototype.respondsTo=function(e){return"value"===e},e.prototype.createEvent=function(e,t){var n=t._queryParams.getIndex();return new zo("value",this,new Xo(e.snapshotNode,new Jo(t._repo,t._path),n))},e.prototype.getEventRunner=function(e){var t=this;return"cancel"===e.getEventType()?function(){return t.callbackContext.onCancel(e.error)}:function(){return t.callbackContext.onValue(e.snapshot,null)}},e.prototype.createCancelEvent=function(e,t){return this.callbackContext.hasCancelCallback?new Ho(this,e,t):null},e.prototype.matches=function(t){return t instanceof e&&(!t.callbackContext||!this.callbackContext||t.callbackContext.matches(this.callbackContext))},e.prototype.hasAnyCallback=function(){return null!==this.callbackContext},e}(),ls=function(){function e(e,t){this.eventType=e,this.callbackContext=t}return e.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t},e.prototype.createCancelEvent=function(e,t){return this.callbackContext.hasCancelCallback?new Ho(this,e,t):null},e.prototype.createEvent=function(e,t){l(null!=e.childName,"Child events should have a childName.");var n=ts(new Jo(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new zo(e.type,this,new Xo(e.snapshotNode,n,r),e.prevName)},e.prototype.getEventRunner=function(e){var t=this;return"cancel"===e.getEventType()?function(){return t.callbackContext.onCancel(e.error)}:function(){return t.callbackContext.onValue(e.snapshot,e.prevName)}},e.prototype.matches=function(t){return t instanceof e&&(this.eventType===t.eventType&&(!this.callbackContext||!t.callbackContext||this.callbackContext.matches(t.callbackContext)))},e.prototype.hasAnyCallback=function(){return!!this.callbackContext},e}();function hs(e,t,n,r,i){var o;if("object"==typeof r&&(o=void 0,i=r),"function"==typeof r&&(o=r),i&&i.onlyOnce){var s=n,a=function(t,n){Ro(e._repo,e,c),s(t,n)};a.userCallback=n.userCallback,a.context=n.context,n=a}var u=new Vo(n,o||void 0),c="value"===t?new cs(u):new ls(t,u);return function(e,t,n){var r;r=".info"===St(t._path)?vi(e.infoSyncTree_,t,n):vi(e.serverSyncTree_,t,n),ho(e.eventQueue_,t._path,r)}(e._repo,e,c),function(){return Ro(e._repo,e,c)}}function ds(e,t,n,r){return hs(e,"value",t,n,r)}function ps(e,t,n,r){return hs(e,"child_added",t,n,r)}function fs(e,t,n,r){return hs(e,"child_changed",t,n,r)}function _s(e,t,n,r){return hs(e,"child_moved",t,n,r)}function ys(e,t,n,r){return hs(e,"child_removed",t,n,r)}function vs(e,t,n){var r=null,i=n?new Vo(n):null;"value"===t?r=new cs(i):t&&(r=new ls(t,i)),Ro(e._repo,e,r)}var gs=function(){},ms=function(e){function n(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return t(n,e),n.prototype._apply=function(e){Zi("endAt",this._value,e._path,!0);var t=Mn(e._queryParams,this._value,this._key);if($o(t),Go(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Qo(e._repo,e._path,t,e._orderByCalled)},n}(gs);function ws(e,t){return io("endAt","key",t,!0),new ms(e,t)}var bs=function(e){function n(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return t(n,e),n.prototype._apply=function(e){Zi("endBefore",this._value,e._path,!1);var t,n,r,i,o=(t=e._queryParams,n=this._value,r=this._key,t.index_===Kt?("string"==typeof n&&(n=In(n)),i=Mn(t,n,r)):i=Mn(t,n,null==r?qe:In(r)),i.endBeforeSet_=!0,i);if($o(o),Go(o),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Qo(e._repo,e._path,o,e._orderByCalled)},n}(gs);function Cs(e,t){return io("endBefore","key",t,!0),new bs(e,t)}var Es=function(e){function n(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return t(n,e),n.prototype._apply=function(e){Zi("startAt",this._value,e._path,!0);var t=Ln(e._queryParams,this._value,this._key);if($o(t),Go(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Qo(e._repo,e._path,t,e._orderByCalled)},n}(gs);function Ts(e,t){return void 0===e&&(e=null),io("startAt","key",t,!0),new Es(e,t)}var Ss=function(e){function n(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return t(n,e),n.prototype._apply=function(e){Zi("startAfter",this._value,e._path,!1);var t=function(e,t,n){var r;e.index_===Kt?("string"==typeof t&&(t=Sn(t)),r=Ln(e,t,n)):r=Ln(e,t,null==n?je:Sn(n));return r.startAfterSet_=!0,r}(e._queryParams,this._value,this._key);if($o(t),Go(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Qo(e._repo,e._path,t,e._orderByCalled)},n}(gs);function Is(e,t){return io("startAfter","key",t,!0),new Ss(e,t)}var ks=function(e){function n(t){var n=e.call(this)||this;return n._limit=t,n}return t(n,e),n.prototype._apply=function(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Qo(e._repo,e._path,(t=e._queryParams,n=this._limit,(r=t.copy()).limitSet_=!0,r.limit_=n,r.viewFrom_="l",r),e._orderByCalled);var t,n,r},n}(gs);function Rs(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new ks(e)}var Ns=function(e){function n(t){var n=e.call(this)||this;return n._limit=t,n}return t(n,e),n.prototype._apply=function(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Qo(e._repo,e._path,(t=e._queryParams,n=this._limit,(r=t.copy()).limitSet_=!0,r.limit_=n,r.viewFrom_="r",r),e._orderByCalled);var t,n,r},n}(gs);function Ps(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Ns(e)}var xs=function(e){function n(t){var n=e.call(this)||this;return n._path=t,n}return t(n,e),n.prototype._apply=function(e){Ko(e,"orderByChild");var t=new Et(this._path);if(At(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");var n=new bn(t),r=Fn(e._queryParams,n);return Go(r),new Qo(e._repo,e._path,r,!0)},n}(gs);function As(e){if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return oo("orderByChild","path",e,!1),new xs(e)}var Os=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype._apply=function(e){Ko(e,"orderByKey");var t=Fn(e._queryParams,Kt);return Go(t),new Qo(e._repo,e._path,t,!0)},n}(gs);function Ds(){return new Os}var Ls=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype._apply=function(e){Ko(e,"orderByPriority");var t=Fn(e._queryParams,ln);return Go(t),new Qo(e._repo,e._path,t,!0)},n}(gs);function Ms(){return new Ls}var Fs=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype._apply=function(e){Ko(e,"orderByValue");var t=Fn(e._queryParams,Cn);return Go(t),new Qo(e._repo,e._path,t,!0)},n}(gs);function qs(){return new Fs}var js=function(e){function n(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return t(n,e),n.prototype._apply=function(e){if(Zi("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new ms(this._value,this._key)._apply(new Es(this._value,this._key)._apply(e))},n}(gs);function Ws(e,t){return io("equalTo","key",t,!0),new js(e,t)}function Us(e){for(var t,n,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var s=U(e);try{for(var a=o(r),u=a.next();!u.done;u=a.next()){var c=u.value;s=c._apply(s)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return s}!function(e){l(!Vr,"__referenceConstructor has already been defined"),Vr=e}(Jo),function(e){l(!Xr,"__referenceConstructor has already been defined"),Xr=e}(Jo);var Bs={},zs=!1;function Hs(e,t,n,r,i){var o=r||e.options.databaseURL;void 0===o&&(e.options.projectId||Le("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Ae("Using default host for project ",e.options.projectId),o=e.options.projectId+"-default-rtdb.firebaseio.com");var s,a=Uo(o,i),u=a.repoInfo,c=void 0;"undefined"!=typeof process&&(c=process.env.FIREBASE_DATABASE_EMULATOR_HOST),c?(s=!0,o="http://"+c+"?ns="+u.namespace,u=(a=Uo(o,i)).repoInfo):s=!a.repoInfo.secure;var l=i&&s?new tt(tt.OWNER):new et(e.name,e.options,t);ao("Invalid Firebase Database URL",a),At(a.path)||Le("Database URL must point to the root of a Firebase Database (not including a child path).");var h=function(e,t,n,r){var i=Bs[t.name];i||(i={},Bs[t.name]=i);var o=i[e.toURLString()];o&&Le("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return o=new vo(e,zs,n,r),i[e.toURLString()]=o,o}(u,e,l,new Ze(e.name,n));return new Vs(h,e)}var Vs=function(){function e(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}return Object.defineProperty(e.prototype,"_repo",{get:function(){return this._instanceStarted||(go(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_root",{get:function(){return this._rootInternal||(this._rootInternal=new Jo(this._repo,Tt())),this._rootInternal},enumerable:!1,configurable:!0}),e.prototype._delete=function(){var e,t,n;return this._checkNotDeleted("delete"),e=this._repo,t=this.app.name,(n=Bs[t])&&n[e.key]===e||Le("Database "+t+"("+e.repoInfo_+") has already been deleted."),No(e),delete n[e.key],this._repoInternal=null,this._rootInternal=null,Promise.resolve()},e.prototype._checkNotDeleted=function(e){null===this._rootInternal&&Le("Cannot call "+e+" on a deleted database.")},e}();function Ys(e,t,r,i){void 0===i&&(i={}),(e=U(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&Le("Cannot call useEmulator() after instance has already been initialized.");var o=e._repoInternal,s=void 0;if(o.repoInfo_.nodeAdmin)i.mockUserToken&&Le('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new tt(tt.OWNER);else if(i.mockUserToken){var a=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var r=t||"demo-project",i=e.iat||0,o=e.sub||e.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var s=n({iss:"https://securetoken.google.com/"+r,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},e);return[p.encodeString(JSON.stringify({alg:"none",type:"JWT"}),!1),p.encodeString(JSON.stringify(s),!1),""].join(".")}(i.mockUserToken,e.app.options.projectId);s=new tt(a)}!function(e,t,n,r){e.repoInfo_=new ot(t+":"+n,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams),r&&(e.authTokenProvider_=r)}(o,t,r,s)}function Qs(e){(e=U(e))._checkNotDeleted("goOffline"),No(e._repo)}function Ks(e){var t;(e=U(e))._checkNotDeleted("goOnline"),(t=e._repo).persistentConnection_&&t.persistentConnection_.resume(yo)}var Gs={".sv":"timestamp"};var $s=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}();function Js(e,t,n){var r;if(e=U(e),so("Reference.transaction",e._path),".length"===e.key||".keys"===e.key)throw"Reference.transaction failed: "+e.key+" is a read-only object.";var i=null===(r=null==n?void 0:n.applyLocally)||void 0===r||r,o=new v,s=ds(e,(function(){}));return function(e,t,n,r,i,o){Po(e,"transaction on "+t);var s={path:t,update:n,onComplete:r,status:null,order:Ie(),applyLocally:o,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Ao(e,t,void 0);s.currentInputSnapshot=a;var u=s.update(a.val());if(void 0===u)s.unwatcher(),s.currentOutputSnapshotRaw=null,s.currentOutputSnapshotResolved=null,s.onComplete&&s.onComplete(null,!1,s.currentInputSnapshot);else{eo("transaction failed: Data returned ",u,s.path),s.status=0;var c=ji(e.transactionQueueTree_,t),h=Wi(c)||[];h.push(s),Ui(c,h);var d=void 0;"object"==typeof u&&null!==u&&R(u,".priority")?(d=N(u,".priority"),l(Xi(d),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):d=(gi(e.serverSyncTree_,t)||yn.EMPTY_NODE).getPriority().val();var p=wo(e),f=gn(u,d),_=Mi(f,a,p);s.currentOutputSnapshotRaw=f,s.currentOutputSnapshotResolved=_,s.currentWriteId=To(e);var y=di(e.serverSyncTree_,t,_,s.currentWriteId,s.applyLocally);po(e.eventQueue_,t,y),Oo(e,e.transactionQueueTree_)}}(e._repo,e._path,t,(function(t,n,r){var i=null;t?o.reject(t):(i=new Xo(r,new Jo(e._repo,e._path),ln),o.resolve(new $s(n,i)))}),s,i),o.promise}var Xs=function(){function e(e){this._delegate=e}return e.prototype.cancel=function(e){M("OnDisconnect.cancel",0,1,arguments.length),q("OnDisconnect.cancel","onComplete",e,!0);var t=this._delegate.cancel();return e&&t.then((function(){return e(null)}),(function(t){return e(t)})),t},e.prototype.remove=function(e){M("OnDisconnect.remove",0,1,arguments.length),q("OnDisconnect.remove","onComplete",e,!0);var t=this._delegate.remove();return e&&t.then((function(){return e(null)}),(function(t){return e(t)})),t},e.prototype.set=function(e,t){M("OnDisconnect.set",1,2,arguments.length),q("OnDisconnect.set","onComplete",t,!0);var n=this._delegate.set(e);return t&&n.then((function(){return t(null)}),(function(e){return t(e)})),n},e.prototype.setWithPriority=function(e,t,n){M("OnDisconnect.setWithPriority",2,3,arguments.length),q("OnDisconnect.setWithPriority","onComplete",n,!0);var r=this._delegate.setWithPriority(e,t);return n&&r.then((function(){return n(null)}),(function(e){return n(e)})),r},e.prototype.update=function(e,t){if(M("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,Me("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}q("OnDisconnect.update","onComplete",t,!0);var i=this._delegate.update(e);return t&&i.then((function(){return t(null)}),(function(e){return t(e)})),i},e}(),Zs=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return M("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}(),ea=function(){function e(e,t){this._database=e,this._delegate=t}return e.prototype.val=function(){return M("DataSnapshot.val",0,0,arguments.length),this._delegate.val()},e.prototype.exportVal=function(){return M("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()},e.prototype.toJSON=function(){return M("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()},e.prototype.exists=function(){return M("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()},e.prototype.child=function(t){return M("DataSnapshot.child",0,1,arguments.length),t=String(t),oo("DataSnapshot.child","path",t,!1),new e(this._database,this._delegate.child(t))},e.prototype.hasChild=function(e){return M("DataSnapshot.hasChild",1,1,arguments.length),oo("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)},e.prototype.getPriority=function(){return M("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority},e.prototype.forEach=function(t){var n=this;return M("DataSnapshot.forEach",1,1,arguments.length),q("DataSnapshot.forEach","action",t,!1),this._delegate.forEach((function(r){return t(new e(n._database,r))}))},e.prototype.hasChildren=function(){return M("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()},Object.defineProperty(e.prototype,"key",{get:function(){return this._delegate.key},enumerable:!1,configurable:!0}),e.prototype.numChildren=function(){return M("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size},e.prototype.getRef=function(){return M("DataSnapshot.ref",0,0,arguments.length),new na(this._database,this._delegate.ref)},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),e}(),ta=function(){function e(e,t){this.database=e,this._delegate=t}return e.prototype.on=function(t,n,r,i){var o,s=this;M("Query.on",2,4,arguments.length),q("Query.on","callback",n,!1);var a=e.getCancelAndContextArgs_("Query.on",r,i),u=function(e,t){n.call(a.context,new ea(s.database,e),t)};u.userCallback=n,u.context=a.context;var c=null===(o=a.cancel)||void 0===o?void 0:o.bind(a.context);switch(t){case"value":return ds(this._delegate,u,c),n;case"child_added":return ps(this._delegate,u,c),n;case"child_removed":return ys(this._delegate,u,c),n;case"child_changed":return fs(this._delegate,u,c),n;case"child_moved":return _s(this._delegate,u,c),n;default:throw new Error(F("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},e.prototype.off=function(e,t,n){if(M("Query.off",0,3,arguments.length),ro("Query.off",e,!0),q("Query.off","callback",t,!0),j("Query.off","context",n,!0),t){var r=function(){};r.userCallback=t,r.context=n,vs(this._delegate,e,r)}else vs(this._delegate,e)},e.prototype.get=function(){var e=this;return us(this._delegate).then((function(t){return new ea(e.database,t)}))},e.prototype.once=function(t,n,r,i){var o=this;M("Query.once",1,4,arguments.length),q("Query.once","callback",n,!0);var s=e.getCancelAndContextArgs_("Query.once",r,i),a=new v,u=function(e,t){var r=new ea(o.database,e);n&&n.call(s.context,r,t),a.resolve(r)};u.userCallback=n,u.context=s.context;var c=function(e){s.cancel&&s.cancel.call(s.context,e),a.reject(e)};switch(t){case"value":ds(this._delegate,u,c,{onlyOnce:!0});break;case"child_added":ps(this._delegate,u,c,{onlyOnce:!0});break;case"child_removed":ys(this._delegate,u,c,{onlyOnce:!0});break;case"child_changed":fs(this._delegate,u,c,{onlyOnce:!0});break;case"child_moved":_s(this._delegate,u,c,{onlyOnce:!0});break;default:throw new Error(F("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return a.promise},e.prototype.limitToFirst=function(t){return M("Query.limitToFirst",1,1,arguments.length),new e(this.database,Us(this._delegate,Rs(t)))},e.prototype.limitToLast=function(t){return M("Query.limitToLast",1,1,arguments.length),new e(this.database,Us(this._delegate,Ps(t)))},e.prototype.orderByChild=function(t){return M("Query.orderByChild",1,1,arguments.length),new e(this.database,Us(this._delegate,As(t)))},e.prototype.orderByKey=function(){return M("Query.orderByKey",0,0,arguments.length),new e(this.database,Us(this._delegate,Ds()))},e.prototype.orderByPriority=function(){return M("Query.orderByPriority",0,0,arguments.length),new e(this.database,Us(this._delegate,Ms()))},e.prototype.orderByValue=function(){return M("Query.orderByValue",0,0,arguments.length),new e(this.database,Us(this._delegate,qs()))},e.prototype.startAt=function(t,n){return void 0===t&&(t=null),M("Query.startAt",0,2,arguments.length),new e(this.database,Us(this._delegate,Ts(t,n)))},e.prototype.startAfter=function(t,n){return void 0===t&&(t=null),M("Query.startAfter",0,2,arguments.length),new e(this.database,Us(this._delegate,Is(t,n)))},e.prototype.endAt=function(t,n){return void 0===t&&(t=null),M("Query.endAt",0,2,arguments.length),new e(this.database,Us(this._delegate,ws(t,n)))},e.prototype.endBefore=function(t,n){return void 0===t&&(t=null),M("Query.endBefore",0,2,arguments.length),new e(this.database,Us(this._delegate,Cs(t,n)))},e.prototype.equalTo=function(t,n){return M("Query.equalTo",1,2,arguments.length),new e(this.database,Us(this._delegate,Ws(t,n)))},e.prototype.toString=function(){return M("Query.toString",0,0,arguments.length),this._delegate.toString()},e.prototype.toJSON=function(){return M("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()},e.prototype.isEqual=function(t){if(M("Query.isEqual",1,1,arguments.length),!(t instanceof e)){var n="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(n)}return this._delegate.isEqual(t._delegate)},e.getCancelAndContextArgs_=function(e,t,n){var r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,q(e,"cancel",r.cancel,!0),r.context=n,j(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(F(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r},Object.defineProperty(e.prototype,"ref",{get:function(){return new na(this.database,new Jo(this._delegate._repo,this._delegate._path))},enumerable:!1,configurable:!0}),e}(),na=function(e){function n(t,n){var r=e.call(this,t,new Qo(n._repo,n._path,new Dn,!1))||this;return r.database=t,r._delegate=n,r}return t(n,e),n.prototype.getKey=function(){return M("Reference.key",0,0,arguments.length),this._delegate.key},n.prototype.child=function(e){return M("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new n(this.database,ts(this._delegate,e))},n.prototype.getParent=function(){M("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new n(this.database,e):null},n.prototype.getRoot=function(){return M("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)},n.prototype.set=function(e,t){M("Reference.set",1,2,arguments.length),q("Reference.set","onComplete",t,!0);var n=is(this._delegate,e);return t&&n.then((function(){return t(null)}),(function(e){return t(e)})),n},n.prototype.update=function(e,t){if(M("Reference.update",1,2,arguments.length),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,Me("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}so("Reference.update",this._delegate._path),q("Reference.update","onComplete",t,!0);var i=as(this._delegate,e);return t&&i.then((function(){return t(null)}),(function(e){return t(e)})),i},n.prototype.setWithPriority=function(e,t,n){M("Reference.setWithPriority",2,3,arguments.length),q("Reference.setWithPriority","onComplete",n,!0);var r=ss(this._delegate,e,t);return n&&r.then((function(){return n(null)}),(function(e){return n(e)})),r},n.prototype.remove=function(e){M("Reference.remove",0,1,arguments.length),q("Reference.remove","onComplete",e,!0);var t=rs(this._delegate);return e&&t.then((function(){return e(null)}),(function(t){return e(t)})),t},n.prototype.transaction=function(e,t,n){var r=this;M("Reference.transaction",1,3,arguments.length),q("Reference.transaction","transactionUpdate",e,!1),q("Reference.transaction","onComplete",t,!0),uo("Reference.transaction","applyLocally",n,!0);var i=Js(this._delegate,e,{applyLocally:n}).then((function(e){return new Zs(e.committed,new ea(r.database,e.snapshot))}));return t&&i.then((function(e){return t(null,e.committed,e.snapshot)}),(function(e){return t(e,!1,null)})),i},n.prototype.setPriority=function(e,t){M("Reference.setPriority",1,2,arguments.length),q("Reference.setPriority","onComplete",t,!0);var n=os(this._delegate,e);return t&&n.then((function(){return t(null)}),(function(e){return t(e)})),n},n.prototype.push=function(e,t){var r=this;M("Reference.push",0,2,arguments.length),q("Reference.push","onComplete",t,!0);var i=ns(this._delegate,e),o=i.then((function(e){return new n(r.database,e)}));t&&o.then((function(){return t(null)}),(function(e){return t(e)}));var s=new n(this.database,i);return s.then=o.then.bind(o),s.catch=o.catch.bind(o,void 0),s},n.prototype.onDisconnect=function(){return so("Reference.onDisconnect",this._delegate._path),new Xs(new Yo(this._delegate._repo,this._delegate._path))},Object.defineProperty(n.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),n}(ta),ra=function(){function e(e,t){var n=this;this._delegate=e,this.app=t,this.INTERNAL={delete:function(){return n._delegate._delete()}}}return e.prototype.useEmulator=function(e,t,n){void 0===n&&(n={}),Ys(this._delegate,e,t,n)},e.prototype.ref=function(e){if(M("database.ref",0,1,arguments.length),e instanceof na){var t=es(this._delegate,e.toString());return new na(this,t)}t=Zo(this._delegate,e);return new na(this,t)},e.prototype.refFromURL=function(e){var t="database.refFromURL";M(t,1,1,arguments.length);var n=es(this._delegate,e);return new na(this,n)},e.prototype.goOffline=function(){return M("database.goOffline",0,0,arguments.length),Qs(this._delegate)},e.prototype.goOnline=function(){return M("database.goOnline",0,0,arguments.length),Ks(this._delegate)},e.ServerValue={TIMESTAMP:Gs,increment:function(e){return function(e){return{".sv":{increment:e}}}(e)}},e}();var ia=Object.freeze({__proto__:null,forceLongPolling:function(){vt.forceDisallow(),ft.forceAllow()},forceWebSockets:function(){ft.forceDisallow()},isWebSocketsAvailable:function(){return vt.isAvailable()},setSecurityDebugCallback:function(e,t){e._delegate._repo.persistentConnection_.securityDebugCallback_=t},stats:function(e,t){!function(e,t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var n;t?(e.statsListener_||(e.statsListener_=new Qn(e.stats_)),n=e.statsListener_.get()):n=e.stats_.get();var r=Object.keys(n).reduce((function(e,t){return Math.max(t.length,e)}),0);Ve(n,(function(e,t){for(var n=e,i=e.length;i<r+2;i++)n+=" ";console.log(n+t)}))}}(e._delegate._repo,t)},statsIncrementCounter:function(e,t){!function(e,t){var n,r;e.stats_.incrementCounter(t),n=e.statsReporter_,r=t,n.statsToReport_[r]=!0}(e._delegate._repo,t)},dataUpdateCount:function(e){return e._delegate._repo.dataUpdateCount},interceptServerData:function(e,t){return function(e,t){e.interceptServerDataCallback_=t}(e._delegate._repo,t)},initStandalone:function(e){var t=e.app,n=e.url,r=e.version,i=e.customAuthImpl,o=e.namespace,s=e.nodeAdmin,a=void 0!==s&&s;ge(r);var u=new H("auth-internal",new Y("database-standalone"));return u.setComponent(new B("auth-internal",(function(){return i}),"PRIVATE")),{instance:new ra(Hs(t,u,void 0,n,a),t),namespace:o}}}),oa=Ht;Ht.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Ht.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var sa,aa=mt,ua=ot,ca=Object.freeze({__proto__:null,DataConnection:oa,RealTimeConnection:aa,hijackHash:function(e){var t=Ht.prototype.put;return Ht.prototype.put=function(n,r,i,o){void 0!==o&&(o=e()),t.call(this,n,r,i,o)},function(){Ht.prototype.put=t}},ConnectionTarget:ua,queryIdentifier:function(e){return e._delegate._queryIdentifier},forceRestClient:function(e){!function(e){zs=e}(e)}}),la=ra.ServerValue;ge((sa=ye).SDK_VERSION),sa.INTERNAL.registerComponent(new B("database",(function(e,t){var n=t.instanceIdentifier,r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),o=e.getProvider("app-check-internal");return new ra(Hs(r,i,o,n),r)}),"PUBLIC").setServiceProps({Reference:na,Query:ta,Database:ra,DataSnapshot:ea,enableLogging:xe,INTERNAL:ia,ServerValue:la,TEST_ACCESS:ca}).setMultipleInstances(!0)),sa.registerVersion("@firebase/database","0.10.1");function ha(e){const t=new Uint8Array(e);for(let n=0;n<e;n++)t[n]=256*Math.random()|0;return t}function da(){if("undefined"==typeof globalThis)return null;const e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null}function pa(e,t){return Object.defineProperty(e,"code",{value:t,enumerable:!0,configurable:!0}),e}function fa(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}class _a{constructor(e={}){if(this._map=new Map,this._id=ha(4).toString("hex").slice(0,7),this._doDebug=e.debug,this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||ha(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||_a.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},_a.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(e=>e),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=void 0===e.trickle||e.trickle,this.allowHalfTrickle=void 0!==e.allowHalfTrickle&&e.allowHalfTrickle,this.iceCompleteTimeout=e.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&"object"==typeof e.wrtc?e.wrtc:da(),!this._wrtc)throw"undefined"==typeof window?pa(new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):pa(new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(e){return void this.destroy(pa(e,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc="number"==typeof this._pc._peerConnectionId,this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=e=>{this._onIceCandidate(e)},"object"==typeof this._pc.peerIdentity&&this._pc.peerIdentity.catch((e=>{this.destroy(pa(e,"ERR_PC_PEER_IDENTITY"))})),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=e=>{this._setupData(e)},this.streams&&this.streams.forEach((e=>{this.addStream(e)})),this._pc.ontrack=e=>{this._onTrack(e)},this._debug("initial negotiation"),this._needsNegotiation()}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&"open"===this._channel.readyState}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this.destroying){if(this.destroyed)throw pa(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then((()=>{this.destroyed||(this._pendingCandidates.forEach((e=>{this._addIceCandidate(e)})),this._pendingCandidates=[],"offer"===this._pc.remoteDescription.type&&this._createAnswer())})).catch((e=>{this.destroy(pa(e,"ERR_SET_REMOTE_DESCRIPTION"))})),e.sdp||e.candidate||e.renegotiate||e.transceiverRequest||this.destroy(pa(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const t=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(t).catch((e=>{var n;!t.address||t.address.endsWith(".local")?(n="Ignoring unsupported ICE candidate.",console.warn(n)):this.destroy(pa(e,"ERR_ADD_ICE_CANDIDATE"))}))}send(e){if(!this.destroying){if(this.destroyed)throw pa(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}addTransceiver(e,t){if(!this.destroying){if(this.destroyed)throw pa(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(e){this.destroy(pa(e,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}}addStream(e){if(!this.destroying){if(this.destroyed)throw pa(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach((t=>{this.addTrack(t,e)}))}}addTrack(e,t){if(this.destroying)return;if(this.destroyed)throw pa(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const n=this._senderMap.get(e)||new Map;let r=n.get(t);if(r)throw r.removed?pa(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):pa(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED");r=this._pc.addTrack(e,t),n.set(t,r),this._senderMap.set(e,n),this._needsNegotiation()}replaceTrack(e,t,n){if(this.destroying)return;if(this.destroyed)throw pa(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const r=this._senderMap.get(e),i=r?r.get(n):null;if(!i)throw pa(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,r),null!=i.replaceTrack?i.replaceTrack(t):this.destroy(pa(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,t){if(this.destroying)return;if(this.destroyed)throw pa(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const n=this._senderMap.get(e),r=n?n.get(t):null;if(!r)throw pa(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{r.removed=!0,this._pc.removeTrack(r)}catch(e){"NS_ERROR_UNEXPECTED"===e.name?this._sendersAwaitingStable.push(r):this.destroy(pa(e,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this.destroying){if(this.destroyed)throw pa(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach((t=>{this.removeTrack(t,e)}))}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,queueMicrotask((()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1})))}negotiate(){if(!this.destroying){if(this.destroyed)throw pa(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout((()=>{this._createOffer()}),0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(e){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),queueMicrotask((()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",e&&(e.message||e)),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._channel){try{this._channel.close()}catch(e){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(e){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close")})))}_setupData(e){if(!e.channel)return this.destroy(pa(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer","number"==typeof this._channel.bufferedAmountLowThreshold&&(this._channel.bufferedAmountLowThreshold=65536),this.channelName=this._channel.label,this._channel.onmessage=e=>{this._onChannelMessage(e)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=e=>{this.destroy(pa(e,"ERR_DATA_CHANNEL"))};let t=!1;this._closingInterval=setInterval((()=>{this._channel&&"closing"===this._channel.readyState?(t&&this._onChannelClose(),t=!0):t=!1}),5e3)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout((()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))}),this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then((e=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(e.sdp=fa(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;const t=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:t.type,sdp:t.sdp})};this._pc.setLocalDescription(e).then((()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))})).catch((e=>{this.destroy(pa(e,"ERR_SET_LOCAL_DESCRIPTION"))}))})).catch((e=>{this.destroy(pa(e,"ERR_CREATE_OFFER"))}))}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach((e=>{e.mid||!e.sender.track||e.requested||(e.requested=!0,this.addTransceiver(e.sender.track.kind))}))}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then((e=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(e.sdp=fa(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;const t=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:t.type,sdp:t.sdp}),this.initiator||this._requestMissingTransceivers()};this._pc.setLocalDescription(e).then((()=>{this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))})).catch((e=>{this.destroy(pa(e,"ERR_SET_LOCAL_DESCRIPTION"))}))})).catch((e=>{this.destroy(pa(e,"ERR_CREATE_ANSWER"))}))}_onConnectionStateChange(){this.destroyed||"failed"===this._pc.connectionState&&this.destroy(pa(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),"connected"!==e&&"completed"!==e||(this._pcReady=!0,this._maybeReady()),"failed"===e&&this.destroy(pa(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&this.destroy(pa(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const t=e=>("[object Array]"===Object.prototype.toString.call(e.values)&&e.values.forEach((t=>{Object.assign(e,t)})),e);0===this._pc.getStats.length||this._isReactNativeWebrtc?this._pc.getStats().then((n=>{const r=[];n.forEach((e=>{r.push(t(e))})),e(null,r)}),(t=>e(t))):this._pc.getStats.length>0?this._pc.getStats((n=>{if(this.destroyed)return;const r=[];n.result().forEach((e=>{const n={};e.names().forEach((t=>{n[t]=e.stat(t)})),n.id=e.id,n.type=e.type,n.timestamp=e.timestamp,r.push(t(n))})),e(null,r)}),(t=>e(t))):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this.getStats(((t,n)=>{if(this.destroyed)return;t&&(n=[]);const r={},i={},o={};let s=!1;n.forEach((e=>{"remotecandidate"!==e.type&&"remote-candidate"!==e.type||(r[e.id]=e),"localcandidate"!==e.type&&"local-candidate"!==e.type||(i[e.id]=e),"candidatepair"!==e.type&&"candidate-pair"!==e.type||(o[e.id]=e)}));const a=e=>{s=!0;let t=i[e.localCandidateId];t&&(t.ip||t.address)?(this.localAddress=t.ip||t.address,this.localPort=Number(t.port)):t&&t.ipAddress?(this.localAddress=t.ipAddress,this.localPort=Number(t.portNumber)):"string"==typeof e.googLocalAddress&&(t=e.googLocalAddress.split(":"),this.localAddress=t[0],this.localPort=Number(t[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let n=r[e.remoteCandidateId];n&&(n.ip||n.address)?(this.remoteAddress=n.ip||n.address,this.remotePort=Number(n.port)):n&&n.ipAddress?(this.remoteAddress=n.ipAddress,this.remotePort=Number(n.portNumber)):"string"==typeof e.googRemoteAddress&&(n=e.googRemoteAddress.split(":"),this.remoteAddress=n[0],this.remotePort=Number(n[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(n.forEach((e=>{"transport"===e.type&&e.selectedCandidatePairId&&a(o[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&a(e)})),s||Object.keys(o).length&&!Object.keys(i).length){if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(t){return this.destroy(pa(t,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const e=this._cb;this._cb=null,e(null)}"number"!=typeof this._channel.bufferedAmountLowThreshold&&(this._interval=setInterval((()=>this._onInterval()),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")}else setTimeout(e,100)}))};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>65536||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||("stable"===this._pc.signalingState&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach((e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0})),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||this._iceComplete||(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let t=e.data;t instanceof ArrayBuffer&&(t=new Uint8Array(t)),this.emit("data",t)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(e){this.destroyed||e.streams.forEach((t=>{this._debug("on track"),this.emit("track",e.track,t),this._remoteTracks.push({track:e.track,stream:t}),this._remoteStreams.some((e=>e.id===t.id))||(this._remoteStreams.push(t),queueMicrotask((()=>{this._debug("on stream"),this.emit("stream",t)})))}))}_debug(...e){this._doDebug&&(e[0]="["+this._id+"] "+e[0],console.log(...e))}on(e,t){const n=this._map;n.has(e)||n.set(e,new Set),n.get(e).add(t)}off(e,t){const n=this._map,r=n.get(e);r&&(r.delete(t),0===r.size&&n.delete(e))}once(e,t){const n=(...r)=>{this.off(e,n),t(...r)};this.on(e,n)}emit(e,...t){const n=this._map;if(n.has(e))for(const r of n.get(e))try{r(...t)}catch(e){console.error(e)}}}_a.WEBRTC_SUPPORT=!!da(),_a.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},_a.channelConfig={};const ya="0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz",va=(e,t)=>(n,r)=>{if(e[r])throw Sa(`already joined room ${r}`);if(!n)throw Sa("requires a config map as the first argument");if(!n.appId)throw Sa("config map is missing appId field");if(!r)throw Sa("namespace argument required");return t(n,r)},ga="Trystero",ma=new Array(20).fill().map((()=>ya[Math.floor(Math.random()*ya.length)])).join("");const{keys:wa,values:ba,entries:Ca,fromEntries:Ea}=Object,Ta=()=>{},Sa=e=>new Error(`Trystero: ${e}`),Ia=e=>(new TextEncoder).encode(e),ka=e=>(new TextDecoder).decode(e),Ra=Ea(["close","connect","data","error","signal","stream"].map((e=>[e,e]))),Na=Object.getPrototypeOf(Uint8Array),Pa=12,xa=16370,Aa="bufferedamountlow";var Oa=(e,t)=>{const n={},r={},i={},o={},s=e=>{if(!e)throw Sa("action type argument is required");if(r[e])throw Sa(`action '${e}' already registered`);const t=Ia(e);if(t.byteLength>Pa)throw Sa(`action type string "${e}" (${t.byteLength}b) exceeds byte limit (12). Hint: choose a shorter name.`);const o=new Uint8Array(Pa);o.set(t);const s=ka(o);let a=0;return r[s]=Ta,i[e]={},[async(e,t,r)=>{const i=Ca(n);if(!i.length)return;if(r&&"object"!=typeof r)throw Sa("action meta argument must be an object");const s="object"==typeof e||"number"==typeof e,u=e instanceof Blob,c=u||e instanceof ArrayBuffer||e instanceof Na;if(r&&!c)throw Sa("action meta argument can only be used with binary data");const l=c?new Uint8Array(u?await e.arrayBuffer():e):Ia(s?JSON.stringify(e):e),h=r?Ia(JSON.stringify(r)):null,d=Math.ceil(l.byteLength/xa)+(r?1:0),p=new Array(d).fill().map(((e,t)=>{const n=t===d-1,i=r&&0===t,u=new Uint8Array(14+(i?h.byteLength:n?l.byteLength-xa*(d-(r?2:1)):xa));return u.set(o),u.set([a],o.byteLength),u.set([n|i<<1|c<<2|s<<3],o.byteLength+1),u.set(r?i?h:l.subarray((t-1)*xa,t*xa):l.subarray(t*xa,(t+1)*xa),14),u}));a=a+1&255;const f=async([e,t])=>{const r=t._channel;let i=0;for(;i<d&&(r.bufferedAmount>r.bufferedAmountLowThreshold&&await new Promise((e=>{const t=()=>{r.removeEventListener(Aa,t),e()};r.addEventListener(Aa,t)})),n[e]);)t.send(p[i++])};return Promise.all(t?(Array.isArray(t)?t:[t]).flatMap((e=>{const t=n[e];return t?f([e,t]):(console.warn(`no peer with id ${e} found`),[])})):i.map(f))},e=>r[s]=e]},[a,u]=s("__91n6__"),[c,l]=s("__90n6__"),[h,d]=s("__516n4L__");let p,f=Ta,_=Ta,y=Ta;return e(((e,t)=>{n[t]||(n[t]=e,p&&e.addStream(p),e.on(Ra.signal,(e=>h(e,t))),e.on(Ra.close,(()=>(e=>{n[e]&&(delete n[e],delete i[e],delete o[e],_(e))})(t))),e.on(Ra.stream,(e=>y(e,t))),e.on(Ra.data,(e=>{const n=new Uint8Array(e),o=ka(n.subarray(0,Pa)),s=n.subarray(Pa,13)[0],a=n.subarray(13,14)[0],u=n.subarray(14),c=!!(1&a),l=!!(2&a),h=!!(4&a),d=!!(8&a);if(!r[o])throw Sa(`received message with unregistered type (${o})`);i[t]||(i[t]={}),i[t][o]||(i[t][o]={});let p=i[t][o][s];if(p||(p=i[t][o][s]={chunks:[]}),l?p.meta=JSON.parse(ka(u)):p.chunks.push(u),!c)return;const f=(e=>{const t=new Uint8Array(e.reduce(((e,t)=>e+t.byteLength),0));return e.reduce(((e,n)=>(t.set(n,e),e+n.byteLength)),0),t})(p.chunks);if(h)r[o](f,t,p.meta);else{const e=ka(f);r[o](d?JSON.parse(e):e,t)}delete i[t][o][s]})),e.on(Ra.error,(e=>{"ERR_DATA_CHANNEL"!==e.code&&console.error(e)})),setTimeout(f,0,t))})),u(((e,t)=>c(null,t))),l(((e,t)=>{o[t]&&(o[t](),delete o[t])})),d(((e,t)=>{n[t]&&n[t].signal(e)})),{makeAction:s,ping:async e=>{if(!e)throw Sa("ping() must be called with target peer ID");const t=Date.now();return a(null,e),await new Promise((t=>o[e]=t)),Date.now()-t},leave:()=>{Ca(n).forEach((([e,t])=>{t.destroy(),delete n[e]})),t()},getPeers:()=>wa(n),addStream:(e,t)=>{if("string"==typeof t){const r=n[t];if(!r)throw Sa(`no peer with id ${t} found`);r.addStream(e)}else t||(p=e),ba(n).forEach((t=>t.addStream(e)))},removeStream:(e,t)=>{if(t){const r=n[t];if(!r)throw Sa(`no peer with id ${t} found`);r.removeStream(e)}else ba(n).forEach((t=>t.removeStream(e)))},onPeerJoin:e=>f=e,onPeerLeave:e=>_=e,onPeerStream:e=>y=e}};const Da=`__${ga.toLowerCase()}__`,La={},Ma={},Fa=(...e)=>e.join("/"),qa="child_added",ja="value",Wa=e=>Ma[e.appId]?Ma[e.appId]:Ma[e.appId]=ye.initializeApp({databaseURL:`https://${e.appId}.firebaseio.com`}).database(),Ua=va(La,((e,t)=>{const n=Wa(e),r={},i={},o=e.rootPath||Da,s=n.ref(Fa(o,t)),a=s.child(ma),u=(i,s)=>{if(r[i])return r[i];const a=((e,t,n)=>new _a({initiator:e,trickle:t,config:n}))(s,!0,e.rtcConfig);return a.on(Ra.connect,(()=>l(a,i))),a.on(Ra.signal,(e=>{const r=n.ref(Fa(o,t,i,ma)).push();r.onDisconnect().remove(),r.set(JSON.stringify(e))})),r[i]=a,a};let c=!1,l=Ta;return La[t]=!0,a.set({_:!0}),a.onDisconnect().remove(),a.on(qa,(e=>{const t=e.key;"_"!==t&&e.ref.on(qa,(e=>{if(t in i||(i[t]={}),e.key in i[t])return;let n;i[t][e.key]=!0;try{n=JSON.parse(e.val())}catch(e){return void console.error("Trystero: received malformed SDP JSON")}u(t,!1).signal(n),e.ref.remove()}))})),s.once(ja,(()=>c=!0)),s.on(qa,(({key:e})=>{c&&e!==ma&&u(e,!0)})),Oa((e=>l=e),(()=>{a.off(),a.remove(),s.off(),delete La[t]}))})),Ba=va(La,((e,t)=>new Promise((n=>Wa(e).ref(Fa(e.rootPath||Da,t)).once(ja,(e=>n(wa(e.val()||{})))))))),za=document.getElementById.bind(document),Ha=za("canvas"),Va=za("peer-info"),Ya=Va.innerText,Qa={appId:"trystero-94db3"},Ka={},Ga=["","","","","","","","","","","","","","","",""],$a=()=>Ga[Math.floor(Math.random()*Ga.length)];let Ja,Xa,Za,eu=0,tu=0;function nu([e,t],n){const r=Ka[n];r&&(r.style.left=e*window.innerWidth+"px",r.style.top=t*window.innerHeight+"px")}function ru(e,t){const n=document.createElement("div"),r=document.createElement("img"),i=document.createElement("p");return n.className="cursor"+(t?" self":""),n.style.left=n.style.top="-99px",r.src="images/hand.png",i.innerText=t?"you":e.slice(0,4),n.appendChild(r),n.appendChild(i),Ha.appendChild(n),Ka[e]=n,t||ou(),n}function iu(e){Ka[e]&&Ha.removeChild(Ka[e]),ou()}function ou(){const e=Ja.getPeers().length;Va.innerHTML=e?`Right now <em>${e}</em> other peer${1===e?" is":"s are"} connected with you. Send them some fruit.`:Ya}function su([e,t,n]){const r=document.createElement("div");r.className="fruit",r.innerText=e,r.style.left=t*window.innerWidth+"px",r.style.top=n*window.innerHeight+"px",Ha.appendChild(r),setTimeout((()=>Ha.removeChild(r)),3e3)}!async function e(t){const n="room"+t;let r,i;if(33===(await Ba(Qa,n)).length)return e(t+1);Ja=Ua(Qa,n),[Xa,r]=Ja.makeAction("mouseMove"),[Za,i]=Ja.makeAction("click"),za("room-num").innerText="room #"+t,Ja.onPeerJoin(ru),Ja.onPeerLeave(iu),r(nu),i(su)}(49),document.documentElement.className="ready",ru(ma,!0),window.addEventListener("mousemove",(({clientX:e,clientY:t})=>{eu=e/window.innerWidth,tu=t/window.innerHeight,nu([eu,tu],ma),Ja&&Xa([eu,tu])})),window.addEventListener("click",(()=>{const e=[$a(),eu,tu];su(e),Ja&&Za(e)})),window.addEventListener("touchstart",(e=>{const t=e.touches[0].clientX/window.innerWidth,n=e.touches[0].clientY/window.innerHeight,r=[$a(),t,n];su(r),nu([t,n],ma),Ja&&(Xa([t,n]),Za(r))}))}();
